<html lang="en"><head><style>*{margin:0;}canvas{height:100vh;position:absolute;width:100vw;}</style></head><canvas></canvas></html><script>!function(t){var i={};function s(h){if(i[h])return i[h].t;var e=i[h]={i:h,s:!1,t:{}};return t[h].call(e.t,e,e.t,s),e.s=!0,e.t}s.h=t,s.c=i,s.d=function(t,i,h){s.o(t,i)||Object.defineProperty(t,i,{l:!0,get:h})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},s.p=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.u)return t;var h=Object.create(null);if(s.r(h),Object.defineProperty(h,"default",{l:!0,value:t}),2&i&&"string"!=typeof t)for(var e in t)s.d(h,e,function(i){return t[i]}.bind(null,e));return h},s.n=function(t){var i=t&&t.u?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.m="",s(s.M=2)}([function(t,i,s){t.t=function(){return s(1)('!function(n){var t={};function r(f){if(t[f])return t[f].t;var e=t[f]={u:f,i:!1,t:{}};return n[f].call(e.t,e,e.t,r),e.i=!0,e.t}r.o=n,r.c=t,r.d=function(n,t,f){r.v(n,t)||Object.defineProperty(n,t,{l:!0,get:f})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"s",{value:!0})},r.h=function(n,t){if(1&t&&(n=r(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.s)return n;var f=Object.create(null);if(r.r(f),Object.defineProperty(f,"default",{l:!0,value:n}),2&t&&"string"!=typeof n)for(var e in n)r.d(f,e,function(t){return n[t]}.bind(null,e));return f},r.n=function(n){var t=n&&n.s?function(){return n.default}:function(){return n};return r.d(t,"a",t),t},r.v=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},r.p="",r(r.M=0)}([function(n,t,r){"use strict";r.r(t);var f={j:[{u:[0,100,128,0,1,201,128,0,0,0,0,8,28,0,0,0,194,4,1,3,25,191,115,244,147,6,43,4],p:[5,1,2,2,1,1,1,1,3,4,1,2,1,2,1,2,,,7,7,7,7,7,7,7,7],c:[{n:[132,132,134,134,135,135,132,132,137,137,135,135,134,134,135,135,139,139,137,137,135,135,137,137,134,,133,,132,,131],f:[21,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,48]},{n:[132,132,134,134,135,135,132,132,137,137,135,135,134,134,135,135,139,139,137,137,135,135,137,137,139,139,135,135,134,134,130,130],f:[,,,,,,,,,,,,,,,,,,,,,,,,,,,11,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,31]},{n:[],f:[]},{n:[159,,,,,,,,158,,,,,,,,157,,,,,,,,156,155,154,153,152,151,150,149],f:[13,,,,,,,,,,,,,,,,,,,,,,,,13,,13,,13,,13,11,29,,,,,,,,,,,,,,,,,,,,,,,,32,,41,,29,,25,15]},{n:[132,132,134,134,135,135,132,132,137,137,135,135,134,134,135,135,139,139,137,137,135,135,137,137,139,139,135,135,134,134,130,130],f:[13,11,21,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,17,29,,25,113,,,,,,,,,,,,,,,,,,,,,,,,,,,,194]},{n:[120,,,,,,,,132,,,,,,,,120,,,,,,,,108],f:[]},{n:[132,144,134,146,132,144,135,147,132,144,137,149,132,144,139,151,140,152,139,151,137,149,139,151,138,150,137,149,135,147,134,146],f:[]}]},{u:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,0,0,2,14,1,1,39,76,5,0,0],p:[,,1,3,1,3,1,3,2,,,,1,3,1,3,1,3,,,1,3,1,3,1,3],c:[{n:[147,,,,,,147,,,,147,,,,,,147,,,,,,147,,,,147,,,,147],f:[]},{n:[147],f:[]},{n:[147,,,,,,147,,,,147,,,,147,,147,,,,,,147,,,,147,,,,147,147],f:[]}]},{u:[0,0,140,0,0,0,140,0,0,60,4,10,68,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[,,1,1,2,3,2,3,4,,,,2,3,2,3,2,3,,,5,5,5,5,5,5],c:[{n:[,,,,147,,,,,,,,148,,,,,,,,147,,,,,,,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,147,147,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,68]},{n:[147,,,147,,,147,,147,,,147,,147,,147,147,,,147,,,147,,147,,,147,,147,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]}]},{u:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,0,0,136,5,1,2,8,93,22,56,148,5,85,8],p:[3,,2,1,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[120],f:[]},{n:[120],f:[]},{n:[120],f:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,56]}]},{u:[3,0,127,0,3,68,127,0,1,218,11,0,40,0,0,1,55,4,1,2,67,115,124,190,67,6,39,1],p:[,,,2,1,2,1,2,3,,,,1,2,1,2,1,2,,,1,4,1,4,1,4],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]},{n:[,,,,147,,,,,,147,,147,,,,,,,,147,,,,,,,,147],f:[]},{n:[147],f:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,,147],f:[]}]},{u:[3,91,128,0,0,95,128,12,0,0,12,0,67,0,0,0,0,0,0,2,255,15,0,32,83,3,51,4],p:[,,,,1,2,1,2,1,2,,,1,2,3,2,1,2,,,,,5,4,5,4],c:[{n:[156,,,164,,,163,,161,,,,,,,,,,158,,159,,161,,159,,158,,159,,154,,159],f:[5,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]},{n:[144,,,147,,,149,,151,,,,,,,,,,149,,151,,152,,151,,151,,147,,147,,139],f:[]},{n:[156,,,156,,,156,,154,,,154,,,154,,152,,,152,,,152,,151,,,147,,,146,,,,151,,,151,,151,,,146,,,146,,146,,,144,,,144,,144,,,142,,,139,,137],f:[5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3]},{n:[163,,164,,166,,163,,163,,164,,166,,163,,163,,164,,166,,163,,163,,164,,166,,163],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25]},{n:[168,,170,,171,,168,,168,,170,,171,,168,,159,,159,,158,,158,,157,,157,,156,,156],f:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]}]}],m:5513,O:32,A:25,g:6};let e=new function(){var n,t,r,f,e,u=function(n){return Math.sin(6.283184*n)},a=function(n){return.003959503758*Math.pow(2,(n-128)/12)},i=function(n,t,r){var f,e,u,i,c,v,l,s=o[n.u[0]],h=n.u[1],b=n.u[3],p=o[n.u[4]],M=n.u[5],y=n.u[8],j=n.u[9],d=n.u[10]*n.u[10]*4,m=n.u[11]*n.u[11]*4,w=n.u[12]*n.u[12]*4,O=1/w,A=n.u[13],g=r*Math.pow(2,2-n.u[14]),I=new Int32Array(d+m+w),S=0,L=0;for(f=0,e=0;d+m+w>f;f++,e++)0>e||(e-=g,v=a(t+(15&(A=A>>8|(255&A)<<4))+n.u[2]-128),l=a(t+(15&A)+n.u[6]-128)*(1+8e-4*n.u[7])),u=1,d>f?u=f/d:d+m>f||(u-=(f-d-m)*O),i=v,b&&(i*=u*u),c=s(S+=i)*h,i=l,y&&(i*=u*u),c+=p(L+=i)*M,j&&(c+=(2*Math.random()-1)*j),I[f]=80*c*u|0;return I},o=[u,function(n){return.5>n%1?1:-1},function(n){return n%1*2-1},function(n){var t=n%1*4;return 2>t?t-1:3-t}];this.init=function(u){n=u,r=0,f=u.m*u.O*((t=u.A)+1)*2,e=new Int32Array(f)},this.I=function(){var a,c,v,l,s,h,b,p,M,y,j,d,m,w,O=new Int32Array(f),A=n.j[r],g=n.m,I=n.O,S=0,L=0,_=!1,x=[];for(v=0;t>=v;++v)for(b=A.p[v],l=0;I>l;++l){var C=b?A.c[b-1].f[l]:0;C&&(A.u[C-1]=A.c[b-1].f[l+I]||0,16>C&&(x=[]));var D=o[A.u[15]],P=A.u[16]/512,U=Math.pow(2,A.u[17]-9)/g,k=A.u[18],q=A.u[19],z=135.82764118168*A.u[20]/44100,B=1-A.u[21]/255,E=1e-5*A.u[22],F=A.u[23]/32,G=A.u[24]/512,H=6.283184*Math.pow(2,A.u[25]-9)/g,J=A.u[26]/255,K=A.u[27]*g&-2;for(j=(v*I+l)*g,s=0;4>s;++s)if(h=b?A.c[b-1].n[l+s*I]:0){x[h]||(x[h]=i(A,h,g));var N=x[h];for(c=0,a=2*j;N.length>c;c++,a+=2)O[a]+=N[c]}for(c=0;g>c;c++)(y=O[p=2*(j+c)])||_?(d=z,k&&(d*=D(U*p)*P+.5),L+=(d=1.5*Math.sin(d))*(m=B*(y-L)-(S+=d*L)),y=3==q?L:1==q?m:S,E&&(y=1>(y*=E)?y>-1?u(.25*y):-1:1,y/=E),_=(y*=F)*y>1e-5,w=y*(1-(M=Math.sin(H*p)*G+.5)),y*=M):w=0,K>p||(w+=O[p-K+1]*J,y+=O[p-K]*J),O[p]=0|w,O[p+1]=0|y,e[p]+=0|w,e[p+1]+=0|y}return++r/n.g},this.S=function(){var n=44+2*f-8,t=n-36,r=new Uint8Array(44+2*f);r.set([82,73,70,70,255&n,n>>8&255,n>>16&255,n>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var u=0,a=44;f>u;++u){var i=e[u];r[a++]=255&(i=-32767>i?-32767:i>32767?32767:i),r[a++]=i>>8&255}return r},this.getData=function(n,t){for(var r=2*Math.floor(44100*n),f=Array(t),u=0;2*t>u;u+=1){var a=r+u;f[u]=n>0&&e.length>a?e[a]/32768:0}return f}};e.init(f),e.init(f);let u=!1;setInterval((function(){if(!u&&(u=e.I()>=1,u)){let n=e.S();postMessage(n)}}),10),t.default=e}]);',null)}},function(t){"use strict";var i=window.URL||window.webkitURL;t.t=function(t,s){try{try{var h;try{(h=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),h=h.getBlob()}catch(i){h=new Blob([t])}return new Worker(i.createObjectURL(h))}catch(i){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(t){if(!s)throw Error("Inline worker is not supported");return new Worker(s)}}},function(t,i,s){"use strict";s.r(i);class h{constructor({g:t,ch:i}){this.k=Array(500).fill(0).map(()=>[Math.random()*t,Math.random()*i,Math.floor(6*Math.random())])}v(t){t.v(()=>{t.j("#600c0c","#0c6060")}),this.k.forEach(([i,s,h])=>{t.rect({$:!1,X:"#fff"+h,rect:[i,s,8-h,8-h]})})}}const e={W:"////////4Af/4AAPwAD+AAAHgAD+AAADgAAAAAADgAAAAAABgAAAAAABwAAAAAABwAA8AAABwAD/gAAD4AD/gAAD/A//wAAD////4AAB//////gB//////gB//////gB/////+AB///wAAAB//4AAAAB/gAAAAAB8AAAAAAB4AAAAAAB4AAAAAABwAAAAAABwAAAAAAHgAAAAAAfgAAAAAH/gAAAAD//gAAAAP//gAAAA///gAAAB///gAAAD///gAAAH///gAAAH///gAAAH///gAAAH/8HwAAAP+ADwAAAP4ABwAAADgABwAAAAAABwAAAAAABwAAAAAAB4AAAAAAB8AAAAAAB/8AAAAAB//gAAAAD//4AAAAf////////",_:[[4,2],[38,2],[43,37],[11,31]],q:[[4,6]],J:[[38,6],[38,37],[12,26]],Z:[[43,40],[42,3],[42,5],[43,42],[14,31],[16,31],[18,31],[41,41],[41,43]],tt:[[35,42],[35,44],[33,44],[33,42],[33,40],[35,40],[31,44],[31,42],[31,40]],it:[[7,3]],st:[[9,3]]},n=["NORMAL","HOLE","MINE"];class r{constructor(){this.ht(e)}ht(t){this.et=((t,i=48)=>{const s=atob(t).split("").map(t=>{return i=t.charCodeAt(0).toString(2),"00000000".substr(i.length)+i;var i}).join(""),h=RegExp(`.{1,${i}}`,"g");return s.match(h).map(t=>Array.from(t).map(t=>+t))})(t.W,t.rows),this._=t._,this.q=t.q,this.it=t.it,this.st=t.st,this.J=t.J,this.Z=t.Z,this.tt=t.tt,this.height=this.et.length,this.width=this.et[0].length}nt(){}rt(t,i){return[Math.floor(t/r.ot),Math.floor(i/r.ot)]}at(t,i,s=!0){return[t*r.ot+(s?r.ot/2:0),i*r.ot+(s?r.ot/2:0)]}v(t){this.et.forEach((i,s)=>{let h=!!(s%2);i.forEach((i,e)=>{h=!h,"HOLE"!==n[i]&&t.rect({X:"#202028"+((e**3+s**2)%48+192).toString(16),rect:[e*r.lt,s*r.ct,r.lt,r.ct]})})})}}r.ut=(t,i)=>[t*r.lt/r.ot,i*r.ct/r.ot],r.size=3840,r.ot=80,r.lt=80,r.ct=80;var o=r;class a{constructor(){this.selected=[]}nt({dt:t,ft:i,map:s,At:h,pt:e,yt:n}){this.selected=e.selected,this.wt=e.wt,this.Mt=i.width,this.gt=i.height,this.bt=this.Mt-a.kt-a.Ct,this.xt=this.gt-a.kt-a.Ct,this.vt=250+2*a.Ct,this.jt=i.height-a.kt-a.Ct,this.Bt=this.zt({pt:e}),this.It="",this.selected.length&&((h.Tt[0]||h.Tt[1])&&this.Dt({dt:t,At:h,pt:e}),(h.Ot[0]||h.Ot[1])&&this.Pt({dt:t,At:h})),this.Et({dt:t,ft:i,map:s,At:h,pt:e}),this.St({dt:t,ft:i,map:s,At:h,pt:e,yt:n})}Et({dt:t,ft:i,map:s,At:h,pt:e}){const{Lt:n,x:r,y:a}=e.Ft(h.Tt,h.Lt,i,t);if(n){const h=(a-i.height/(o.ct/o.ot*o.size)*250/2)/250*80*s.height;t.Ht((r-i.width/o.size*250/2)/250*80*s.width),t.Yt(h)}}St({dt:t,ft:i,map:s,At:h,pt:e,yt:n}){const{Lt:r,x:o,y:a}=e.Ft(h.Nt,h.$t,i,t);if(r){const t=o/250*80*s.width,i=a/250*80*s.height;e.selected.length>0&&e.Xt(e.selected,s,[t,i],n)}}Dt({dt:t,At:i,pt:s}){let[h,e]=i.Tt;this.Bt.forEach(({x:i,y:n,width:r,height:o,action:a})=>{a.name&&h-t.x>=i&&i+r>h-t.x&&e-t.y>=n&&n+o>e-t.y&&a.Rt()&&a.Gt({pt:s})})}Pt({dt:t,At:i}){let[s,h]=i.Ot;this.Bt.forEach(({x:i,y:e,width:n,height:r,action:o})=>{s-t.x>=i&&i+n>s-t.x&&h-t.y>=e&&e+r>h-t.y&&(this.It=o.name)})}zt({pt:t}){if(0===this.selected.length)return[];const[i]=this.selected;return i.Ut({pt:t}).map((t,i)=>({x:this.bt+20+i%3*60+10*(i%3-1),y:this.jt+20+60*Math.floor(i/3)+10*(Math.floor(i/3)-1),width:60,height:60,icon:t.Wt,action:t}))}v(t){const i=t.width-140;if(t.rect({$:!1,X:"#69c",rect:[i,17,20,20]}),t.text({text:""+this.wt,x:i+30,y:15,size:5}),t.rect({$:!1,X:"#666",rect:[0,t.height-a.kt-2*a.Ct,t.width,a.kt+2*a.Ct]}),t.rect({$:!1,X:"#111",rect:[this.vt,this.jt,t.width-a.kt-250-4*a.Ct,a.kt]}),1===this.selected.length){const[i]=this.selected;t.text({text:i.name,x:this.vt+20,y:this.jt+20,size:5}),i.Kt(t,this.vt+20,this.jt+20+60,i.name),t.text({text:`${i._t} / ${i.qt}`,x:this.vt+20,y:this.jt+20+140,size:3})}else this.selected.length>1&&this.selected.slice(0,24).forEach((i,s)=>{const h=this.vt+20+s%8*60+10*(s%8-1),e=this.jt+20+60*Math.floor(s/8)+10*(Math.floor(s/8)-1);t.rect({$:!1,Jt:"#0f0",rect:[h,e,60,60]}),t.rect({$:!1,Jt:"#0f0",rect:[h,e,60,60]}),i.Vt(t,h,e,i.name)});t.rect({$:!1,X:"#111",rect:[this.bt,this.xt,a.kt,a.kt]}),1===this.selected.length&&this.Bt.forEach(({x:i,y:s,width:h,height:e,icon:n,action:r})=>{r.name&&(t.rect({$:!1,Jt:r.Rt()?"#0f0":"rgba(100, 100, 100, 0.7)",rect:[i,s,h,e]}),n(t,i,s),r.Rt()||t.rect({$:!1,X:"rgba(100, 100, 100, 0.7)",rect:[i,s,h,e]}))}),this.It&&t.text({text:this.It,x:this.bt+10,y:this.xt+210-17,size:3})}}a.Qt=(t,i,s)=>{t.ellipse({$:!1,ellipse:[i+30,s+30,20,20,0,0,2*Math.PI],Jt:"#0F0",strokeWidth:6}),t.v(()=>{t.rect({$:!1,rect:[i+15,s+15,40,6],X:"#0F0",rotation:Math.PI/4,size:6})})},a.kt=220,a.Ct=10;var l=a,c={blood:{v:function(t){t.rect({X:this.color,rect:[this.x,this.y,5,5]})}},chunk:{v:function(t){t.rect({X:this.color,rect:[this.x,this.y-10,10,15]}),[[1,2],[2,3]].forEach(([i,s])=>{t.rect({X:this.color,rect:[this.x+5*(i-2),this.y+5*(s-2),5,5]})}),[[2,0],[1,1],[0,2],[1,3]].forEach(([i,s])=>{t.rect({X:"#FF77A8",rect:[this.x+5*(i-2),this.y+5*(s-2),5,5]})})}},bit:{v:function(t){t.rect({X:this.color,rect:[this.x,this.y,20,20]})}}},u=class{constructor(t,i,s,h,e,n){const r=c[t];this.type=t,this.Zt=s,this.x=i,this.y=s,this.dx=h,this.dy=e,this.color=n,this.ti=!1,this.ii=!1,this.si=.6,this.hi=r.v}ei({map:t}){const[i,s]=t.rt(this.x,this.y);t.et[s][i]&&(this.ii=!0),this.ti=!0}nt({map:t}){this.ti||(this.x+=this.dx,this.dy+=this.si,this.y+=this.dy,this.y-10*Math.random()>this.Zt&&this.ei({map:t}))}v(t){this.ii||this.hi.call(this,t)}};class d{constructor(t,i,s,h,e,n=null,r){this._t=s._t,this.ni=s.ni,this.ri=s.ri,this.name=s.name,this.oi=s.Ut,this.ai=e?0:s.li,this.cost=s.cost,this.ci=s.ci,this.Wt=s.Wt,this.x=t,this.y=i,this.ui=0,this.qt=this._t,this.selected=!1,this.type="building",this.di=[],this.color=h,this.fi=r,this.Ai=0,this.pi=e,this.mi=n,this.yi="#666",this.wi=0}Mi(){this.Ai=20}gi(t,{bi:i,d:s}){this._t-=t;for(let h=0;t>h;h++)i.add(new u("blood",this.x+this.ni/2,this.y+this.ri/2,8*Math.random()-4+2*s.dx,-16*Math.random()-8+2*s.dy,this.yi));return 0>=this._t}ki({bi:t,yt:i}){i.play("death");for(let i=0;100>i;i++)t.add(new u("blood",this.x+this.ni/2,this.y+this.ri/2,8*Math.random()-4,-16*Math.random()-8,this.yi));for(let i=0;20>i;i++){const i=Math.floor(34*Math.random()+51);t.add(new u("bit",this.x+this.ni/2,this.y+this.ri/2,8*Math.random()-4,-16*Math.random()-8,`#${i}${i}${i}`))}}Ci(){return this}nt({pt:t}){this.ui+=1;const[i]=this.di;if(i&&(i.time-=1,0>=i.time)){const{complete:i}=this.di.shift();i({pt:t})}this.Ai>0&&(this.Ai-=1)}xi(t,{}){this.di.push({...t,vi:t.time})}Ut({pt:t}){let i=[,,,,,,,,,].fill({});return this.pi?this.oi({ji:this,Bi:i,pt:t}):i[8]={name:"cancel",cost:0,Rt:()=>!0,Gt:({pt:t})=>{t.zi(this),t.selected=[]},Wt:l.Qt},i}Ii(t,i,s){const{name:h,time:e,vi:n,Wt:r}=this.di[0];t.text({text:""+h,x:i+200+60+10,y:s+13,size:5});const o=i+200+60+10,a=s+60-10;t.rect({$:!1,Jt:"#0f0",rect:[o,a,200,10]}),t.rect({$:!1,X:"#0f0",rect:[o,a,(n-e)/n*200,10]}),t.rect({$:!1,Jt:"#0f0",rect:[i+200,s,60,60]}),r(t,i+200,s)}Kt(t,i,s){this.Wt(t,i-15,s-20),this.di.length&&(this.Ii(t,i,s),this.di.slice(1).forEach(({Wt:h},e)=>{t.rect({$:!1,Jt:"#0f0",rect:[i+200+70*e,s+60+10,60,60]}),h(t,i+200+70*e,s+10+60)}))}Vt(t,i,s){d.Vt(t,i,s)}v(t){const i=this.ri-o.ot,s=s=>{t.ellipse({ellipse:[this.x+this.ni/2,this.y+i+o.ot,(this.ni+40)/2,i/3,0,0,2*Math.PI],Jt:s,strokeWidth:5})};this.selected&&s("#4AC"),this.Ai>0&&s("#A00"),this.ci(t,this.x,this.y,this.ni,i,this.color,this.pi?"F":"4"),this.wi||t.Ti({x:this.x,y:this.y,color:this.fi,ni:Math.ceil(this.ni/20),ri:Math.ceil(this.ri/20)})}}d.Vt=()=>{};var f=d;const A=function(t,i){return i>t?-1:t>i?1:0},p=function(t,i,s){return null==s&&(s=A),t.push(i),w(t,0,t.length-1,s)},m=function(t,i){var s,h;return null==i&&(i=A),s=t.pop(),t.length?(h=t[0],t[0]=s,M(t,0,i)):h=s,h},y=function(t,i,s){var h;if(null==s&&(s=A),-1!==(h=t.indexOf(i)))return w(t,0,h,s),M(t,h,s)},w=function(t,i,s,h){var e,n,r;for(null==h&&(h=A),e=t[s];s>i&&0>h(e,n=t[r=s-1>>1]);)t[s]=n,s=r;return t[s]=e},M=function(t,i,s){var h,e,n,r,o;for(null==s&&(s=A),e=t.length,o=i,n=t[i],h=2*i+1;e>h;)e>(r=h+1)&&s(t[h],t[r])>=0&&(h=r),t[i]=t[h],h=2*(i=h)+1;return t[i]=n,w(t,o,i,s)},g=function(){function t(t){this.cmp=null!=t?t:A,this.Di=[]}return t.push=p,t.pop=m,t.Oi=y,t.prototype.push=function(t){return p(this.Di,t,this.cmp)},t.prototype.pop=function(){return m(this.Di,this.cmp)},t.prototype.Oi=function(t){return y(this.Di,t,this.cmp)},t.prototype.empty=function(){return 0===this.Di.length},t}();function b(t){for(var i=[[t.x,t.y]];t.parent;)i.push([(t=t.parent).x,t.y]);return i.reverse()}function k(t,i,s,h){var e,n,r,o,a,l,c=Math.abs,u=[];for(e=s>t?1:-1,n=h>i?1:-1,a=(r=c(s-t))-(o=c(h-i));u.push([t,i]),t!==s||i!==h;)(l=2*a)>-o&&(a-=o,t+=e),r>l&&(a+=r,i+=n);return u}var C=function(t,i){return t+i};function x(t,i,s){this.x=t,this.y=i,this.Pi=void 0===s||s}function v(t,i,s){var h;"object"!=typeof t?h=t:(i=t.length,h=t[0].length,s=t),this.width=h,this.height=i,this.Di=this.Ei(h,i,s)}function j(){this.Si=C,this.weight=1,this.Li=2}v.prototype.Ei=function(t,i,s){var h,e,n=Array(i);for(h=0;i>h;++h)for(n[h]=Array(t),e=0;t>e;++e)n[h][e]=new x(e,h);if(void 0===s)return n;if(s.length!==i||s[0].length!==t)throw Error("Matrix size does not fit");for(h=0;i>h;++h)for(e=0;t>e;++e)s[h][e]&&(n[h][e].Pi=!1);return n},v.prototype.Fi=function(t,i){return this.Di[i][t]},v.prototype.Hi=function(t,i){return this.Yi(t,i)&&this.Di[i][t].Pi},v.prototype.Yi=function(t,i){return t>=0&&this.width>t&&i>=0&&this.height>i},v.prototype.Ni=function(t){var i=t.x,s=t.y,h=[],e=this.Di;return this.Hi(i,s-1)&&h.push(e[s-1][i]),this.Hi(i+1,s)&&h.push(e[s][i+1]),this.Hi(i,s+1)&&h.push(e[s+1][i]),this.Hi(i-1,s)&&h.push(e[s][i-1]),h},j.prototype.$i=function(t,i,s,h,e){var n,r,o,a,l,c,u,d,f=new g((function(t,i){return t.f-i.f})),A=e.Fi(t,i),p=e.Fi(s,h),m=this.Si,y=this.weight,w=Math.abs;for(A.Xi=0,A.f=0,f.push(A),A.Ri=!0;!f.empty();){if((n=f.pop()).closed=!0,n===p)return b(p);for(a=0,l=(r=e.Ni(n)).length;l>a;++a)(o=r[a]).closed||(u=o.y,d=n.Xi+((c=o.x)-n.x==0||u-n.y==0?1:1.4142135623730951),o.Ri&&d>=o.Xi||(o.Xi=d,o.Gi=o.Gi||y*m(w(c-s),w(u-h)),o.f=o.Xi+o.Gi,o.parent=n,o.Ri?f.Oi(o):(f.push(o),o.Ri=!0)))}return[]};var B=j;const z=(t,i,s,h,e={})=>{let n,{Ui:r,Wi:o,body:a}=h,l=[];e.blink&&(o="#0000"),n=e.brute?[[r,[0,-1,6,3]],[r,[1,-2,4,5]]]:[[r,[0,0,5,3]]],l=l.concat(n),l=l.concat([[o,[1+(e.brute?1:0),1,1,1]],[o,[4,1,1,1]]]),e.Ki||(l=l.concat([[a,[0,4,3,1]],[r,[0,4,1,1]],[r,[3,4,1,1]]])),e._i&&(l=l.concat([[r,[0,-1,1,1]],[r,[4,-1,1,1]]])),e.qi&&(l=l.concat([[r,[1,-1,1,1]],[r,[0,-2,1,1]],[r,[3,-1,1,1]],[r,[4,-2,1,1]],[o,[2,1,1,1]],[o,[3,1,1,1]]]));const c=e.size||8;return l=l.map(([h,e])=>({c:h,r:[1===s?t+e[0]*c:5*c-(e[0]+e[2])*c+t,e[1]*c+i,e[2]*c,e[3]*c]})),l},I=([t,i,s])=>({Ui:t,Wi:i,body:s}),T={name:"goblin",_t:50,Ji:10,size:40,cost:100,li:150,yi:"#A00",Vi:!0,Qi:t=>I(["#50c878",t,t]),speed:5,Ki:!1,_i:!0,qi:!1,Zi:!0,ts:"gun",ss:!1,hs:!1,mi:!1,range:300,es:90,ns:60};var D={shade:{...T,name:"shade",Ji:1,cost:50,Vi:!1,Qi:t=>I(["#999",t,t]),speed:3,Ki:!0,Zi:!1,ts:"minigun",ss:!0,hs:!0,mi:!0,range:50,es:10,ns:10},goblin:{...T},brute:{...T,name:"brute",_t:100,Ji:15,size:80,cost:200,_i:!1,brute:!0,li:300,Qi:t=>I(["#c80",t,t]),speed:3,range:100},speeder:{...T,name:"speeder",_t:150,Ji:5,cost:200,_i:!1,qi:!0,li:300,Qi:t=>I(["#cff",t,t]),speed:8,range:50},boss:{...T,name:"boss",_t:500,Ji:25,size:200,Qi:t=>I(["#A00",t,t]),speed:1,range:75}};const O=(t,i,s)=>{const{name:h,cost:e,li:n}=D[t];return{name:"build "+h,cost:e,time:n,Rt:function(){return s.wt>=this.cost},Gt:function({pt:t}){return 5>i.di.length&&t.wt>=this.cost&&(t.wt-=this.cost,i.xi(this,{pt:t}),!0)},complete:({pt:s})=>{s.rs({type:t,x:i.x+i.ni+10,y:i.y+i.ri+10})},Wt:(t,i,s)=>{N.Vt(t,i,s,D[h])}}},P=(t,i,s,h,e,n,r="F",a)=>{if(t.rect({X:"#544"+r,rect:[i,s+o.ot,h,e]}),t.ellipse({ellipse:[i+h/2,s+e+o.ot,h/2,e/4,0,0,2*Math.PI],X:"#544"+r}),t.ellipse({ellipse:[i+h/2,s+o.ot,h/2,e/4,0,0,2*Math.PI],X:"#655"+r}),"flag"===a){const e=10,a=100;t.rect({X:"#666"+r,rect:[i+h/2-e/2,s-a+o.ot,e,a]}),t.rect({X:n+r,rect:[i+h/2+e/2,s-a+o.ot,60,40]})}if("shield"===a){const h=70,e=150;t.ellipse({ellipse:[i+h,s+e,100,100,0,0,Math.PI/3],X:n+r}),t.ellipse({ellipse:[i+h+100,s+e,100,100,0,2*Math.PI/3,3*Math.PI/3],X:n+r}),t.os({os:[[i+h,s+e],[i+h+100,s+e],[i+h+50,s+e+100*3**.5/2]],X:n+r})}};var E={base:{name:"base",_t:1e3,li:600,cost:400,ni:3*o.ot,ri:3*o.ot,Ut:({ji:t,Bi:i,pt:s})=>{i[0]=O("shade",t,s)},ci:(...t)=>P(...t,"flag"),Wt:(t,i,s)=>{t.rect({$:!1,rect:[i+14,s+12,7,35],X:"#666"}),t.rect({$:!1,rect:[i+21,s+13,25,18],X:"#0f0"})}},barracks:{name:"barracks",_t:500,li:300,cost:150,ni:3*o.ot,ri:3*o.ot,Ut:({ji:t,Bi:i,pt:s})=>{i[0]=O("goblin",t,s),i[1]=O("brute",t,s),i[2]=O("speeder",t,s)},ci:(...t)=>P(...t,"shield"),Wt:(t,i,s)=>{const h=11.5;t.ellipse({$:!1,ellipse:[i+h,s+13,36,36,0,0,Math.PI/3],X:"#0f0"}),t.ellipse({$:!1,ellipse:[i+h+36,s+13,36,36,0,2*Math.PI/3,3*Math.PI/3],X:"#0f0"}),t.os({$:!1,os:[[i+h,s+13],[i+h+36,s+13],[i+h+18,s+13+36*3**.5/2]],X:"#0f0"})}}};const S=(t,i)=>i.x+(i.size||i.ni)>t.x&&t.x+(t.size||t.ni)>i.x&&i.y+(i.size||i.ri)>t.y&&(t.size||t.ri)+t.y>i.y,L=(t,i)=>i.x>=t.x&&t.x+(t.size||t.ni)>i.x&&i.y>=t.y&&t.y+(t.size||t.ri)>i.y,F=(t,i)=>{const s=Math.abs(t.x-i.x),h=Math.abs(t.y-i.y);return Math.sqrt(Math.pow(s,2)+Math.pow(h,2))},H={as:0,ls:1,cs:2};class Y{constructor(t,i,s){Object.entries(s).forEach(([t,i])=>{this[t]=i}),this.x=t,this.y=i,this.us=i,this.dx=0,this.dy=0,this.qt=this._t,this.ui=0,this.selected=!1,this.path=[[t+100*Math.random(),i+200*Math.random()-100]],this.ds=1,this.type="unit",this.fs=0,this.As=0,this.blink=0,this.target=null,this.Ai=0,this.ps=0,this.state=1,this.ms=0,this.wi=0,this.ys=!1,this.ws=null,this.Ms=null,this.gs=null,this.bs=0,this.ks=0}Mi(){this.Ai=30}Cs(t,i){const[s,h]=t;if(this.hs)return this.path=[t],!0;const[e,n]=i.rt(this.x,this.us),[r,o]=i.rt(s,h),a=new B,l=new v(i.et),c=a.$i(e,n,r,o,l);if(0===c.length)return!1;const u=function(t,i){var s,h,e,n,r,o,a,l,c,u,d=i.length,f=i[d-1][0],A=i[d-1][1];for(e=[[s=i[0][0],h=i[0][1]]],n=2;d>n;++n){for(a=k(s,h,(o=i[n])[0],o[1]),c=!1,r=1;a.length>r;++r)if(!t.Hi((l=a[r])[0],l[1])){c=!0;break}c&&(e.push(u=i[n-1]),s=u[0],h=u[1])}return e.push([f,A]),e}(l,c).map(([t,s])=>i.at(t,s)).slice(1,-1).concat([t]);return this.path=u,!0}xs(t,i){this.target=t,this.state=2,this.ps=15,this.target.Mi();const s=F(this,this.target);this.range>=s||this.Cs([this.target.x,this.target.y],i)}vs(t){this.path=[],this.ws=t,this.state=3}js({ji:t}){this.gs=t,this.state=5}Bs(){let[t,i]=this.path[0],s=F({x:this.x,y:this.us},{x:t,y:i});s>this.speed?(this.dx=this.speed*((t-this.x)/Math.abs(s)),this.dy=this.speed*((i-this.us)/Math.abs(s))):this.path.shift()}gi(t,{bi:i,d:s}){this._t-=t;for(let h=0;t>h;h++)i.add(new u("blood",this.x,this.y+this.size/2,6*Math.random()-3+4*s.dx,-10*Math.random()-5+4*s.dy,this.yi));return 0>=this._t}ki({bi:t,yt:i}){i.play("death");for(let i=0;100>i;i++)t.add(new u("blood",this.x,this.y,10*Math.random()-5,-12*Math.random()-6,this.yi));for(let i=0;5>i;i++)t.add(new u("chunk",this.x,this.y,6*Math.random()-3,-6*Math.random()-6,"red"))}zs(t,i,s=null){this.path=[];let h=s;if(!h){const i=t.Is.filter(t=>"base"===t.name);i.length&&(i.sort((t,i)=>F(this,t)-F(this,i)),h=i[0])}h&&(this.Ms=h,this.Cs([h.x+h.ni/2,h.y+h.ri/2],i),this.state=4)}move(){this.path.length?(this.Bs(),this.ds=this.dx>0?1:0):(this.dx=0,this.dy=0,1===this.state&&(this.state=0)),this.x+=this.dx,this.us+=this.dy}nt({map:t,bi:i,pt:s,yt:h,Ts:e}){if(this.ui+=1,.005>Math.random()&&(this.blink=10),this.blink>0&&(this.blink-=1),0===this.state&&.001>Math.random()&&(this.ds=this.ds?0:1),this.Zi){const t=12,i=12,s=(1===this.state||2===this.state)&&0===this.As,h=0===this.state&&.01>Math.random();(s||h)&&(this.As=i),this.As>0&&(this.As-=1,this.fs=-Math.pow(this.As/(i*(Math.sqrt(t)/(2*t)))-Math.sqrt(t),2)+t)}if(5===this.state&&(0===this.path.length&&this.Cs([this.gs.x+this.gs.ni/2,this.gs.y+this.gs.ri/2],t),S(this.Ci(),this.gs)&&(this.gs.ai-=1,this.gs.ai>0||(this.gs.pi=!0,this.state=0,this.ms=0))),3===this.state&&(this.ys||0!==this.path.length?this.ys&&this.zs(s,t):this.Cs([this.ws.x+this.ws.size/2,this.ws.y+this.ws.size/2],t),S(this.Ci(),this.ws)&&(this.ys=!0,this.zs(s,t))),4===this.state&&S(this.Ci(),this.Ms)&&this.ys&&(s.wt+=5,this.ys=!1,this.Cs([this.ws.x+this.ws.size/2,this.ws.y+this.ws.size/2],t),this.state=3),this.Vi&&0===this.state){const[i]=e.filter(t=>400>=F(this,t));i&&this.xs(i,t)}if(this.target&&0>=this.target._t&&(this.target=null,this.state=0,this.path=[]),this.ks>0&&(this.ks-=1),this.bs>0&&(this.bs-=1),2===this.state){const s=F(this,this.target),e=this.range>=s;if(this.ps-=1,0>this.ps&&!e&&(this.Cs([this.target.x,this.target.y],t),this.ps=15),e&&0===this.bs){h.play(this.ts),this.bs=this.es,this.ks=this.ns,this.path=[];const t=F(this,this.target);this.target.gi(this.Ji,{bi:i,d:{dx:(this.target.x-this.x)/t,dy:(this.target.y-this.us)/t}})}}0===this.ks&&this.move(),this.y=this.us-this.fs,this.Ai>0&&(this.Ai-=1)}Ut({pt:t}){const i=[,,,,,,,,,].fill({}),s={name:"cancel",cost:0,Rt:()=>!0,Wt:l.Qt,Gt:()=>{this.ms=0,t.Ds(),this.gs&&t.zi(this.gs),this.state=0}},h=i=>({name:"build "+i.name,cost:i.cost,Rt:function(){return t.wt>=this.cost},Wt:(t,s,h)=>{i.Wt(t,s,h)},Gt:()=>{t.Os({Ps:this,ji:i.name}),this.ms=2}});return this.state===H.Es?i[5]=s:1===this.ms?(i[0]=h(E.base),i[1]=h(E.barracks),i[5]=s):2===this.ms?i[5]=s:this.mi&&(i[0]={name:"build",cost:0,Rt:()=>!0,Wt:(t,i,s)=>{t.Ss({$:!1,x:i+17,y:s+18,X:"#0F0",rotation:.25*Math.PI,size:26}),t.rect({$:!1,rect:[i+18,s+25,24,20],X:"#0F0"}),t.rect({$:!1,rect:[i+26,s+37,7,8],X:"#111"})},Gt:()=>{this.ms=1}}),i}Vt(t,i,s,h){Y.Vt(t,i,s,{...D[h],Ki:this.Ki})}Kt(t,i,s,h){z(i,s,1,{Ui:"#0f0",Wi:"#666",body:"#666"},{...D[h],size:12}).forEach(({c:i,r:s})=>t.rect({$:!1,X:i,rect:s}))}Ci(){return{x:this.x-this.size/2,y:this.y-this.size/2,size:this.size}}v(t){const i=this.x-this.size/2,s=this.y-this.size/2,h=h=>{t.ellipse({ellipse:[i+this.size/2,s+this.size,(this.size+15)/2,this.size/3,0,0,2*Math.PI],Jt:h,strokeWidth:5})};this.selected&&h("#4AC"),this.Ai>0&&this.Ai%10>5&&h("#A00"),z(i,s,this.ds,this.Qi,{Ki:this.Ki,brute:this.brute,_i:this._i,qi:this.qi,blink:this.blink>0,size:this.size/5}).forEach(({c:i,r:s})=>t.rect({X:i,rect:s})),this.ys&&t.v(()=>{t.rect({X:"#39ca",rect:[i+(this.ds?5:-35)+this.size/2,s+10,30,30],rotation:-.05*Math.PI,size:30})}),5>this.ns-this.ks&&([[1===this.ds?8:-1,3,1,1],[1===this.ds?7:0,4,2,3]].forEach(([h,e,n,r])=>t.rect({X:"yellow",rect:[i+6*h,s+6*e,6*n,6*r]})),[[1===this.ds?8:-1,4,2,2],[1===this.ds?10:-3,4,1,1]].forEach(([h,e,n,r])=>t.rect({X:"white",rect:[i+6*h,s+6*e,6*n,6*r]}))),this.wi||t.Ti({x:i,y:s,color:this.fi,size:Math.ceil(this.size/20)})}}Y.Vt=(t,i,s,h)=>{z(i+14,s+18,1,{Ui:"#0f0",Wi:"#666",body:"#666"},{...h,size:6}).forEach(({c:i,r:s})=>t.rect({$:!1,X:i,rect:s}))};var N=Y,$=class{constructor(){this.wt=100,this.units=[],this.Is=[]}rs({type:t,x:i,y:s}){const h=D[t],e=h.Qi(this.color),n=new N(i,s,{...h,Qi:e,fi:this.fi});this.units.push(n)}Ls({type:t,x:i,y:s,pi:h=!0,Ps:e=null}){const n=new f(i,s,E[t],this.color,h,e,this.fi);return this.Is.push(n),n}zi(t){t.mi.gs=null,t.mi.state=0,this.Is=this.Is.filter(i=>i!==t),this.wt+=t.cost}Fs({ji:t,x:i,y:s,Ps:h}){const e=this.Ls({type:t,x:i,y:s,pi:!1,Ps:h});this.wt-=e.cost,h.js({ji:e})}entities(){return this.units.concat(this.Is)}static nt({map:t,bi:i,yt:s,Ts:h}){this.units.forEach(e=>e.nt({bi:i,map:t,pt:this,yt:s,Ts:h})),this.units=this.units.reduce((t,h)=>(h._t>0?t.push(h):(h.ki({bi:i,yt:s}),this.selected&&this.selected.includes(h)&&(this.selected=this.selected.filter(t=>t!==h))),t),[]),this.Is.forEach(t=>t.nt({pt:this})),this.Is=this.Is.reduce((t,h)=>(h._t>0?t.push(h):(h.ki({bi:i,yt:s}),this.selected&&this.selected.includes(h)&&(this.selected=this.selected.filter(t=>t!==h))),t),[])}static v(t){this.Is.forEach(i=>i.v(t)),this.units.forEach(i=>i.v(t))}};const X=t=>t[Math.floor(Math.random()*t.length)];var R=class extends ${constructor({map:t}){super(),this.color="#00A",this.fi="#F00",t.J.forEach(([t,i])=>{this.Ls({type:"base",x:80*t,y:80*i}),this.Ls({type:"barracks",x:80*t-400,y:80*i})}),this.Ls({type:"barracks",x:3040,y:3280}),t.Z.forEach(([t,i])=>{this.rs({type:"shade",x:80*t,y:80*i})}),t.tt.forEach(([t,i])=>{this.rs({type:"goblin",x:80*t,y:80*i})}),this.rs({type:"boss",x:2880,y:3200}),this.rs({type:"boss",x:2880,y:3440}),this.ui=0}Hs({map:t,_:i}){const s=this.Is.filter(t=>"base"===t.name);if(this.units.filter(t=>"shade"===t.name&&0===t.state).forEach(t=>{i._.sort((i,s)=>F(t,i)-F(t,s));const[s]=i._;t.vs(s)}),0>Math.random()){const i=X(this.units.filter(t=>0===t.state));if(i){const s=[Math.floor(1440+400*Math.random()),Math.floor(80+560*Math.random())],h=i.Cs(s,t);h&&(i.state=1),console.log(`cpu moving ${i.name} to ${s}${h?"":", but failed"}`)}}const h=this.units.filter(t=>t.mi),e=X(s);!e||this.ui%300||h.length>=10||this.Ys(e,"build shade");const n=this.units.filter(t=>!t.mi),r=this.Is.filter(t=>"barracks"===t.name),o=X(r);!o||this.ui%300||n.length>=20||(this.Ys(o,"build goblin"),3>s.length&&this.Ys(o,"build brute"),2>s.length&&this.Ys(o,"build speeder"))}Ys(t,i){if(!t||!t.pi)return!1;const[s]=t.Ut({pt:this}).filter(({name:t})=>t===i);try{const i=s.Gt({pt:this});console.log(`cpu executing ${s.name} on ${t.name}${i?"":", but failed"}, and has ${this.wt} left`)}catch(s){console.log("cpu errored on action",t,i)}}nt({map:t,_:i,bi:s,yt:h,Ts:e}){this.ui+=1,this.Hs({map:t,_:i}),$.nt.call(this,{map:t,bi:s,yt:h,Ts:e})}v(t){$.v.call(this,t)}};let G=null;class U{constructor(){let t=document.querySelector("canvas");this.canvas=t,G=this.canvas.getContext("2d"),this.dt=new class{constructor(){this.x=0,this.y=0,this.Ns=0,this.$s=0,this.Xs=0,this.Rs=0}Ht(t){this.Ns=this.Gs(t)}Yt(t){this.$s=this.Us(t)}Ws(t){return t-this.x}Ks(t){return t-this.y}Gs(t){return Math.min(Math.max(0,t),o.size-this.width)}Us(t){return Math.min(Math.max(0,t),o.size*(o.ct/o.ot)-this.height)}nt({_s:t,At:i}){const s=l.Ct,[h,e]=i.qs;(t.Js(t.Vs)||s>e)&&(this.$s-=15),(t.Js(t.Qs)||e>this.height-s)&&(this.$s+=15),(t.Js(t.Zs)||s>h)&&(this.Ns-=15),(t.Js(t.th)||h>this.width-s)&&(this.Ns+=15),this.Ht(this.Ns),this.Yt(this.$s),this.x=this.Ns,this.y=this.$s}};let i=document.querySelector("body"),s=()=>{this.dt.height=window.innerHeight,this.dt.width=window.innerWidth,t.height=window.innerHeight,t.width=window.innerWidth,this.height=t.height,this.width=t.width};s(),i.onresize=s,this.ih=[]}v(t){G.save(),t(),G.restore()}sh(){G.clearRect(0,0,this.canvas.width,this.canvas.height)}j(t,i){this.v(()=>{const s=G.createLinearGradient(0,0,this.height-l.kt,this.width);s.addColorStop(0,t),s.addColorStop(1,i),G.fillStyle=s,G.fillRect(0,0,this.canvas.width,this.canvas.height)})}rect({rect:t,X:i,Jt:s,shadowBlur:h=0,shadowColor:e="none",opacity:n,lineWidth:r=1,$:o=!0,rotation:a,size:l,hh:c=!0}){c&&(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1])),o&&(t[0]=this.dt.Ws(t[0],this.canvas.width),t[1]=this.dt.Ks(t[1],this.canvas.height)),a&&(G.translate(t[0]+l/2,t[1]+l/2),G.rotate(a),G.translate(-1*t[0]-l/2,-1*t[1]-l/2)),G.shadowBlur=h,G.shadowColor=e,n&&(G.globalAlpha=n),i&&(G.fillStyle=i,G.fillRect(t[0],t[1],...t.slice(2))),s&&(G.strokeStyle=s,G.lineWidth=r,G.strokeRect(t[0],t[1],...t.slice(2))),G.shadowBlur=0,G.globalAlpha=1}Ss({x:t,y:i,$:s=!0,X:h,rotation:e,size:n}){this.v(()=>{if(s&&(t=this.dt.Ws(t,this.canvas.width),i=this.dt.Ks(i,this.canvas.height)),e&&(G.translate(t+n/2,i+n/2),G.rotate(e),G.translate(-1*t-n/2,-1*i-n/2)),h){let s=new Path2D;s.moveTo(t,i),s.lineTo(t+n,i),s.lineTo(t,i+n),s.closePath(),G.fillStyle=h,G.fill(s)}})}ellipse({ellipse:t,$:i=!0,X:s,Jt:h,strokeWidth:e=1,shadowBlur:n,shadowColor:r}){i&&(t[0]=this.dt.Ws(t[0],this.canvas.width),t[1]=this.dt.Ks(t[1],this.canvas.height)),G.beginPath(),G.ellipse(...t),G.shadowBlur=n,G.shadowColor=r,s&&(G.fillStyle=s,G.fill()),h&&(G.strokeStyle=h,G.lineWidth=e,G.stroke()),G.shadowBlur=0}text({text:t,x:i,y:s,X:h="#fff",size:e=1}){G.fillStyle=h;let n=0;t.toUpperCase().split("").map(t=>(W[t]||console.log(t),W[t])).forEach(t=>{let h=0,r=0;t.forEach(t=>{t.forEach((t,r)=>{t&&G.fillRect(n+r*e+i,h+s,e,e)}),r=Math.max(r,t.length*e),h+=e}),n+=e+r})}os({os:t,shadowBlur:i=0,shadowColor:s,X:h,Jt:e,$:n=!0}){G.beginPath();let r=t[0][0],o=t[0][1];n&&(r=this.dt.Ws(r,this.canvas.width),o=this.dt.Ks(o,this.canvas.height)),G.moveTo(r,o),t.slice(1).forEach(([t,i])=>{n&&(t=this.dt.Ws(t,this.canvas.width),i=this.dt.Ks(i,this.canvas.height)),G.lineTo(t,i)}),G.closePath(),G.shadowBlur=i,G.shadowColor=s,e&&(G.strokeStyle=e,G.stroke()),h&&(G.fillStyle=h,G.fill())}Ti({x:t,y:i,size:s,ni:h,ri:e,color:n}){this.ih.push(()=>this.rect({$:!1,X:n,rect:[t/o.size*250+l.Ct,this.canvas.height-250+i/o.size*250-l.Ct,h||s,e||s]}))}eh(){this.ih=[]}nh(){this.ih.forEach(t=>{this.v(t)})}}const W={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]]," ":[[,,],[,,],[,,],[,,],[,,]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[1,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[,,1],[,,1]],5:[[1,1,1],[1,,],[1,1,1],[,,1],[1,1,1]],6:[[1,1,1],[1,,],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,,1],[,,1],[,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]],"/":[[,,1],[,,1],[,1],[1,,],[1,,]],"!":[[,1],[,1],[,1],[,,],[,1]]},K={rh:0,cs:1};var _=class extends ${constructor({map:t}){super(),this.selected=[],this.color="#A00",this.fi="#0F0",t.q.forEach(([t,i])=>{this.Ls({type:"base",x:80*t,y:80*i})}),t.it.forEach(([t,i])=>{this.rs({type:"shade",x:80*t,y:80*i})}),t.st.forEach(([t,i])=>{this.rs({type:"goblin",x:80*t,y:80*i})}),this.mode=K.rh,this.oh=null,this.ah=null,this.lh=null,this.uh=[]}dh(t,i,s){let h=i.filter(i=>{let[s,h,e,n]=t.fh;return S(i.Ci(),{x:s,y:h,ni:e-s,ri:n-h})});h.map(t=>t.type).includes("unit")&&(h=h.filter(t=>"unit"===t.type)),0!==h.length&&(s.play("click"),i.forEach(t=>t.selected=!1),h.forEach(t=>t.selected=!0),this.selected=h)}Ah(t,i,s){let[h,e]=t.Tt;(h||e)&&i.forEach(t=>{L(t.Ci(),{x:h,y:e})&&(i.forEach(t=>t.selected=!1),this.selected=[t],t.selected=!0,s.play("click"))})}select(t,i){const s=[this.units,this.Is].flat();t.fh?this.dh(t,s,i):this.Ah(t,s,i)}ph({mh:t,target:i}){const{Is:s,units:h}=t;return h.concat(s).filter(t=>L(t.Ci(),{x:i[0],y:i[1]}))}yh({mh:t,map:i,_:s,At:h,yt:e,Ps:n}){const{Nt:r}=h;if(5!==n.state&&(h.Nt[0]||h.Nt[1])){if(n.ss){const[t]=s._.filter(t=>L(t,{x:r[0],y:r[1]}));if(t)return n.vs(t),void e.play("click");if(n.ys){const[t]=this.Is.filter(t=>"base"===t.name&&L(t.Ci(),{x:r[0],y:r[1]}));if(t)return n.zs(this,i,t),void e.play("click")}}const[h]=this.ph({mh:t,target:r});return!h||(n.xs(h,i),void e.play("click"))}}Os({Ps:t,ji:i}){this.mode=K.cs,this.oh=t,this.ah=i}Ds(){this.mode=K.as,this.oh=null,this.ah=null}wh(t,i,s){const{Tt:h,Ot:e}=i;if(this.mode===K.cs){const[i,n]=e,[r,a]=t.rt(i,n),[l,c]=t.at(r,a,!1);e&&(this.lh=t=>{E[this.ah].ci(t,l,c,3*o.ot,2*o.ot,this.color,"4")}),(h[0]||h[1])&&(s.play("click"),this.Fs({ji:this.ah,x:l,y:c,map:t,Ps:this.oh}),this.Ds())}}Xt(t,i,s,h){t.forEach((t,h)=>{const[e,n]=[s[0]+h%8*70,s[1]+70*Math.floor(h/8)];t.Cs([e,n],i),this.uh.push({x:e,y:n,time:20}),t.state=1}),h.play("click")}Ft(t,i,s,h){const e=i&&t[0]-l.Ct-h.x,n=i&&t[1]-(s.height-250-l.Ct)-h.y;return{Lt:null!==e&&null!==n&&e>=0&&250>e&&n>=0&&250>n,x:e,y:n}}Mh(t,i,s,h){return i&&t[1]-h.y>=s.height-l.kt-2*l.Ct}gh({dt:t,ft:i,mh:s,map:h,_:e,At:n,yt:r}){const{Lt:o,$t:a,Tt:l,Nt:c}=n;if(this.Ft(l,o,i,t).Lt)return void console.log("minimap click");if(this.Ft(c,a,i,t).Lt)return void console.log("minimap right click");if(this.Mh(l,o,i,t))return void console.log("hud click");if(this.Mh(c,a,i,t))return void console.log("hud right click");this.select(n,r),this.wh(h,n,r);const u=[];this.units.forEach(t=>{t.selected&&this.yh({mh:s,map:h,_:e,At:n,yt:r,Ps:t})&&u.push(t)}),u.length&&this.Xt(u,h,c,r)}nt({dt:t,mh:i,ft:s,map:h,_:e,At:n,bi:r,yt:o,Ts:a}){this.gh({dt:t,mh:i,ft:s,map:h,_:e,At:n,yt:o}),this.uh=this.uh.map(t=>({...t,time:t.time-1})).filter(t=>t.time>0),$.nt.call(this,{map:h,bi:r,yt:o,Ts:a})}v(t){this.mode===K.cs&&this.lh&&this.lh(t),this.uh.forEach(i=>{5>i.time%10&&t.ellipse({ellipse:[i.x,i.y,23,13,0,0,2*Math.PI],Jt:"#4AC",strokeWidth:5})}),$.v.call(this,t)}},q=s(0),J=new(s.n(q).a);let V=null;J.onmessage=t=>{let i=t.data;V=document.createElement("audio"),V.src=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),V.volume=.7,V.loop=!0};class Q{bh(){}kh(){const t=()=>{V?V.play():setTimeout(t,1e3)};t()}}const Z={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),play:function(...t){return this.Ch(this.xh(...t))},Ch:function(...t){const i=this.x.createBuffer(t.length,t[0].length,this.sampleRate),s=this.x.createBufferSource();return t.map((t,s)=>i.getChannelData(s).set(t)),s.buffer=i,s.connect(this.x.destination),s.start(),s},xh:function(t=1,i=.05,s=220,h=0,e=0,n=.1,r=0,o=1,a=0,l=0,c=0,u=0,d=0,f=0,A=0,p=0,m=0,y=1,w=0,M=0){const g=2*Math.PI;let b,k,C=this.sampleRate,x=a*=500*g/C/C,v=s*=(1+2*i*Math.random()-i)*g/C,j=[],B=0,z=0,I=0,T=1,D=0,O=0,P=0;for(l*=500*g/C**3,A*=g/C,c*=g/C,u*=C,d=d*C|0,k=(h=h*C+9)+(w*=C)+(e*=C)+(n*=C)+(m*=C)|0;k>I;j[I++]=P)++O%(100*p|0)||(P=r?r>1?r>2?r>3?Math.sin((B%g)**3):Math.max(Math.min(Math.tan(B),1),-1):1-(2*B/g%2+2)%2:1-4*Math.abs(Math.round(B/g)-B/g):Math.sin(B),P=(d?1-M+M*Math.sin(g*I/d):1)*(P>0?1:-1)*Math.abs(P)**o*t*this.volume*(h>I?I/h:h+w>I?1-(I-h)/w*(1-y):h+w+e>I?y:k-m>I?(k-I-m)/n*y:0),P=m?P/2+(m>I?0:(k-m>I?1:(k-I)/m)*j[I-m|0]/2):P),b=(s+=a+=l)*Math.cos(A*z++),B+=b-b*f*(1-1e9*(Math.sin(I)+1)%2),T&&++T>u&&(s+=c,v+=c,T=0),!d||++D%d||(s=v,a=x,T=T||1);return j},vh:function(t=0,i=440){return i*2**(t/12)}};let tt={death:[2.45,,608,.02,.09,.38,2,1.24,.6,,,,,.3,,.4,.03,.51,.05],gun:[.4,0,0,,,0,4,0,500,,,,,,,.1,,0,.15],jump:[,,131,.02,.02,.08,,1.49,2.3,,,,,,,,,.9,.1],message:[2,0,1740,,.06,.29,,.77,,,,,,,,,,.76,.07,.06],minigun:[.6,0,0,,,0,4,0,1e8,,,,,,,.04,,0,.08],pickup:[,,548,.08,.36,.47,1,1.79,,,236,.03,.08,,,,,.83],shotgun:[.8,,300,,,.9,4,.5,,,,,,10,74,.2,,2],sniper:[.8,,300,,,1.2,4,.5,,,,,,10,74,.1,,2],thrown:[1,0,0,,,0,4,0,1e8,,,,,,,.055,,0,.3],click:[.5,,555,.01,.02,.01,3,.11,,98,-816,.01,.02,,,,,.43,,.02]};class it{constructor(){this.volume=1}play(t,i){const s=[...tt[t]];i&&(s[0]*=i*this.volume),function(...t){Z.play(...t)}(...s)}jh(t){this.volume=t}}let st=0;window.onload=()=>{let t=new U,i=new h({g:t.canvas.width,ch:t.canvas.height}),s=new class{constructor(){document.addEventListener("keyup",t=>this.Bh(t)),document.addEventListener("keydown",t=>this.zh(t)),this.Ih={},this.Zs={_s:[37],dir:"l"},this.Vs={_s:[38]},this.th={_s:[39],dir:"r"},this.Qs={_s:[40]}}Th(t){return t.some(t=>this.Ih[t])}Js(t){return this.Th(t._s)||!1}zh(t){this.Ih[t.keyCode]=!0}Bh(t){delete this.Ih[t.keyCode]}},e=new class{constructor(){let t=document.querySelector("canvas");this.canvas=t,this.canvas.addEventListener("click",t=>this.click(t)),this.canvas.addEventListener("mousedown",t=>this.Dh(t)),this.canvas.addEventListener("mouseup",t=>this.Oh(t)),this.canvas.addEventListener("mousemove",t=>this.Ph(t)),this.canvas.addEventListener("contextmenu",t=>{t.preventDefault(),this.Eh(t)}),this.Sh=[null,null],this.Lh=[null,null],this.Ot=[null,null],this.qs=[500,500],this.Fh=!1,this.Hh=!1,this.fh=null,this.Yh=[null,null]}nt({dt:t}){this.dt=t,this.fh=null,this.Hh&&!this.Fh&&(Math.abs(this.Yh[0]-this.Ot[0])>2||Math.abs(this.Yh[1]-this.Ot[1])>2)&&(this.fh=this.Yh.concat(this.Ot),this.Yh=[null,null]),this.Hh=this.Fh,this.Tt=this.Sh,this.Lt=this.Tt[0]||this.Tt[1],this.Nt=this.Lh,this.$t=this.Nt[0]||this.Nt[1],this.Sh=this.Lh=[null,null]}click({clientX:t,clientY:i}){this.Sh=[t+this.dt.x,i+this.dt.y]}Dh({clientX:t,clientY:i,which:s}){1===s&&(this.Yh=[t+this.dt.x,i+this.dt.y],this.Fh=!0)}Oh(){this.Fh=!1}Ph({clientX:t,clientY:i}){this.dt&&(this.Ot=[t+this.dt.x,i+this.dt.y],this.qs=[t,i])}Eh({clientX:t,clientY:i}){this.Lh=[t+this.dt.x,i+this.dt.y]}v(t){this.Fh&&t.rect({rect:[this.Yh[0],this.Yh[1],this.Ot[0]-this.Yh[0],this.Ot[1]-this.Yh[1]],Jt:"#369"})}},n=new it,r=new class{constructor(){this.Nh=[]}nt({$h:t,mh:i,_:s,map:h}){const e=[];for(let t=0;h.height>t;t++){const t=[];for(let i=0;h.width>i;i++)t.push(1);e.push(t)}const n=t=>Math.min(Math.max(0,t),h.width-1),r=t=>Math.min(Math.max(0,t),h.height-1);t.entities().forEach(t=>{const[i,s]=h.rt(t.x,t.y);for(let t=r(s-10);t<=r(s+10);t++){const h=Math.floor(Math.sqrt(Math.abs(100-Math.abs(t-s)**2)));for(let s=n(i-h);s<=n(i+h);s++)e[t][s]=0}}),i.entities().concat(s._).forEach(t=>{const{x:i,y:s}=t;t.wi=e[Math.floor(s/o.ot)][Math.floor(i/o.ot)]}),this.Nh=e}v(t){this.Nh.forEach((i,s)=>{i.forEach((i,h)=>{i&&t.rect({X:"#222",rect:[h*o.lt,s*o.ct,o.lt,o.ct]})})})}},a=new l,c=new class{constructor(){this.Xh=!1,this.Rh=!1}nt({$h:t,mh:i}){0===i.entities().length&&(this.Rh=!0),0===t.entities().length&&(this.Xh=!0)}v(t){this.Rh&&(t.rect({$:!1,rect:[(t.width-1e3)/2,(t.height-200)/2-100,1e3,200],X:"#111"}),t.text({X:"#EEE",text:"VICTORY!",x:(t.width-1e3)/2+140,y:(t.height-200)/2+48-100,size:20})),this.Xh&&(t.rect({$:!1,rect:[(t.width-1e3)/2,(t.height-200)/2-100,1e3,200],X:"#111"}),t.text({X:"#EEE",text:"DEFEAT!",x:(t.width-1e3)/2+235,y:(t.height-200)/2+48-100,size:20}))}},u=new o,d=new class{constructor({map:t}){this._=[],t._.forEach(([t,i])=>{this._.push(new class{constructor(t,i){this.wt=1e4,this.x=t,this.y=i,this.size=160,this.wi=0}v(t){t.rect({X:"#338",rect:[this.x,this.y+this.size/2,this.size,this.size/2]}),t.ellipse({X:"#338",ellipse:[this.x+this.size/2,this.y+this.size/2,this.size/2,this.size/2,0,0,2*Math.PI]}),t.rect({X:"#111",rect:[this.x+this.size/2-25,this.y+this.size-25,50,25]}),t.ellipse({X:"#111",ellipse:[this.x+this.size/2,this.y+this.size-25,25,25,0,0,2*Math.PI]}),this.wi||t.Ti({x:this.x,y:this.y,color:"#69c",size:Math.ceil(this.size/20)})}}(t*o.ot,i*o.ot))})}nt(){this._.forEach(t=>{t.nt()})}v(t){this._.forEach(i=>{i.v(t)})}}({map:u}),f=new class{constructor(){}v(t){t.rect({$:!1,X:"#666",rect:[0,t.height-250-2*l.Ct,250+2*l.Ct,250+2*l.Ct]}),t.rect({$:!1,X:"#111",rect:[l.Ct,t.height-250-l.Ct,250,250]}),t.rect({$:!1,Jt:"#fff",rect:[t.dt.Ns/o.size*250+l.Ct,t.height-250+t.dt.$s/(o.ct/o.ot*o.size)*250-l.Ct,t.width/o.size*250,t.height/(o.ct/o.ot*o.size)*250]}),t.nh()}},A=new Q,p=new _({map:u}),m=new R({map:u}),y=new class{constructor(){this.bi=[]}add(t){this.bi.push(t)}nt({map:t}){this.bi.length>5e3&&(this.bi=this.bi.slice(this.bi.length-5e3)),this.bi.forEach(i=>i.nt({map:t}))}v(t){this.bi.forEach(i=>i.v(t))}},w=new class{constructor(){this.time=299,this.click=!1}nt({At:t,Gh:i}){const[s,h]=t.Tt;this.click||!s&&!h||(this.click=!0,i.kh()),this.time>0&&this.click&&(this.time-=1)}v(t){const i=(19>this.time?"0":"")+Math.floor(this.time/300*256).toString(16),s="#FFFFFF"+i;t.rect({$:!1,rect:[0,0,t.width,t.height],X:"#111111"+i});const h=t.width/2-380,e=t.height/2-300;t.text({text:"THERE CAN",x:30+h,y:0+e,size:20,X:s}),t.text({text:"BE ONLY",x:110+h,y:150+e,size:20,X:s}),t.text({text:"DEATH",x:0+h,y:300+e,size:40,X:s}),t.text({text:"Click to start",x:t.width/2-135,y:600+e,size:5,X:s})}},M=i=>{window.requestAnimationFrame(M),i-st&&(g(),t.sh(),t.eh(),b().map(i=>i.v(t)),st=i-0)},g=()=>{const{dt:i}=t;c.nt({mh:m,$h:p}),i.nt({_s:s,At:e}),e.nt({dt:i}),m.nt({map:u,_:d,bi:y,yt:n,Ts:p.entities()}),p.nt({dt:i,mh:m,ft:t,map:u,_:d,At:e,bi:y,yt:n,Ts:m.entities()}),a.nt({dt:i,ft:t,map:u,At:e,pt:p,yt:n}),y.nt({map:u}),r.nt({$h:p,mh:m,_:d,map:u}),w.nt({At:e,Gh:A})},b=()=>[i,u,y,d,m,p,e,r,a,f,c,w];M()}}]);</script>
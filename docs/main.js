!function(t){var i={};function s(h){if(i[h])return i[h].t;var e=i[h]={i:h,s:!1,t:{}};return t[h].call(e.t,e,e.t,s),e.s=!0,e.t}s.h=t,s.c=i,s.d=function(t,i,h){s.o(t,i)||Object.defineProperty(t,i,{l:!0,get:h})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},s.p=function(t,i){if(1&i&&(t=s(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.u)return t;var h=Object.create(null);if(s.r(h),Object.defineProperty(h,"default",{l:!0,value:t}),2&i&&"string"!=typeof t)for(var e in t)s.d(h,e,function(i){return t[i]}.bind(null,e));return h},s.n=function(t){var i=t&&t.u?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.m="",s(s.g=0)}([function(t,i,s){"use strict";s.r(i);class h{constructor({k:t,ch:i}){this.v=Array(500).fill(0).map(()=>[Math.random()*t,Math.random()*i,Math.floor(6*Math.random())])}j(t){t.j(()=>{t.$("#600c0c","#0c6060")}),this.v.forEach(([i,s,h])=>{t.rect({_:!1,q:"#fff"+h,rect:[i,s,8-h,8-h]})})}}const e={tt:"////////4Af/4AAPwAD+AAAHgAD+AAADgAAAAAADgAAAAAABgAAAAAABwAAAAAABwAA8AAABwAD/gAAD4AD/gAAD/A//wAAD////4AAB//////gB//////gB//////gB/////+AB///wAAAB//4AAAAB/gAAAAAB8AAAAAAB4AAAAAAB4AAAAAABwAAAAAABwAAAAAAHgAAAAAAfgAAAAAH/gAAAAD//gAAAAP//gAAAA///gAAAB///gAAAD///gAAAH///gAAAH///gAAAH///gAAAH/8HwAAAP+ADwAAAP4ABwAAADgABwAAAAAABwAAAAAABwAAAAAAB4AAAAAAB8AAAAAAB/8AAAAAB//gAAAAD//4AAAAf////////",it:[[4,2],[38,2],[43,37],[11,31]],st:[[4,6]],ht:[[38,6],[38,37],[12,26]],et:[[43,40],[42,3],[42,5],[43,42],[14,31],[16,31],[18,31],[41,41],[41,43]],ot:[[35,42],[35,44],[33,44],[33,42],[33,40],[35,40],[31,44],[31,42],[31,40]],rt:[[7,3]],nt:[[9,3]]},o=["NORMAL","HOLE","MINE"];class r{constructor(){this.lt(e)}lt(t){this.at=((t,i=48)=>{const s=atob(t).split("").map(t=>{return i=t.charCodeAt(0).toString(2),"00000000".substr(i.length)+i;var i}).join(""),h=RegExp(`.{1,${i}}`,"g");return s.match(h).map(t=>Array.from(t).map(t=>+t))})(t.tt,t.rows),this.it=t.it,this.st=t.st,this.rt=t.rt,this.nt=t.nt,this.ht=t.ht,this.et=t.et,this.ot=t.ot,this.height=this.at.length,this.width=this.at[0].length}ct(){}ut(t,i){return[Math.floor(t/r.dt),Math.floor(i/r.dt)]}At(t,i,s=!0){return[t*r.dt+(s?r.dt/2:0),i*r.dt+(s?r.dt/2:0)]}j(t){this.at.forEach((i,s)=>{let h=!!(s%2);i.forEach((i,e)=>{h=!h,"HOLE"!==o[i]&&t.rect({q:"#202028"+((e**3+s**2)%48+192).toString(16),rect:[e*r.ft,s*r.pt,r.ft,r.pt]})})})}}r.yt=(t,i)=>[t*r.ft/r.dt,i*r.pt/r.dt],r.size=3840,r.dt=80,r.ft=80,r.pt=80;var n=r;class l{constructor(){this.selected=[]}ct({wt:t,Mt:i,map:s,gt:h,bt:e,kt:o}){this.selected=e.selected,this.Ct=e.Ct,this.xt=i.width,this.vt=i.height,this.jt=this.xt-l.Bt-l.zt,this.Dt=this.vt-l.Bt-l.zt,this.Tt=250+2*l.zt,this.Pt=i.height-l.Bt-l.zt,this.It=this.Ft({bt:e}),this.Et="",this.selected.length&&((h.St[0]||h.St[1])&&this.Yt({wt:t,gt:h,bt:e}),(h.Ht[0]||h.Ht[1])&&this.Lt({wt:t,gt:h})),this.Ot({wt:t,Mt:i,map:s,gt:h,bt:e}),this.Xt({wt:t,Mt:i,map:s,gt:h,bt:e,kt:o})}Ot({wt:t,Mt:i,map:s,gt:h,bt:e}){const{$t:o,x:r,y:l}=e.Nt(h.St,h.$t,i,t);if(o){const h=(l-i.height/(n.pt/n.dt*n.size)*250/2)/250*80*s.height;t.Rt((r-i.width/n.size*250/2)/250*80*s.width),t.Gt(h)}}Xt({wt:t,Mt:i,map:s,gt:h,bt:e,kt:o}){const{$t:r,x:n,y:l}=e.Nt(h.Wt,h.Ut,i,t);if(r){const t=n/250*80*s.width,i=l/250*80*s.height;e.selected.length>0&&e.Kt(e.selected,s,[t,i],o)}}Yt({wt:t,gt:i,bt:s}){let[h,e]=i.St;this.It.forEach(({x:i,y:o,width:r,height:n,action:l})=>{l.name&&h-t.x>=i&&i+r>h-t.x&&e-t.y>=o&&o+n>e-t.y&&l._t()&&l.Vt({bt:s})})}Lt({wt:t,gt:i}){let[s,h]=i.Ht;this.It.forEach(({x:i,y:e,width:o,height:r,action:n})=>{s-t.x>=i&&i+o>s-t.x&&h-t.y>=e&&e+r>h-t.y&&(this.Et=n.name)})}Ft({bt:t}){if(0===this.selected.length)return[];const[i]=this.selected;return i.qt({bt:t}).map((t,i)=>({x:this.jt+20+i%3*60+10*(i%3-1),y:this.Pt+20+60*Math.floor(i/3)+10*(Math.floor(i/3)-1),width:60,height:60,icon:t.Jt,action:t}))}j(t){const i=t.width-140;if(t.rect({_:!1,q:"#69c",rect:[i,17,20,20]}),t.text({text:""+this.Ct,x:i+30,y:15,size:5}),t.rect({_:!1,q:"#666",rect:[0,t.height-l.Bt-2*l.zt,t.width,l.Bt+2*l.zt]}),t.rect({_:!1,q:"#111",rect:[this.Tt,this.Pt,t.width-l.Bt-250-4*l.zt,l.Bt]}),1===this.selected.length){const[i]=this.selected;t.text({text:i.name,x:this.Tt+20,y:this.Pt+20,size:5}),i.Qt(t,this.Tt+20,this.Pt+20+60,i.name),t.text({text:`${i.Zt} / ${i.ti}`,x:this.Tt+20,y:this.Pt+20+140,size:3})}else this.selected.length>1&&this.selected.slice(0,24).forEach((i,s)=>{const h=this.Tt+20+s%8*60+10*(s%8-1),e=this.Pt+20+60*Math.floor(s/8)+10*(Math.floor(s/8)-1);t.rect({_:!1,ii:"#0f0",rect:[h,e,60,60]}),t.rect({_:!1,ii:"#0f0",rect:[h,e,60,60]}),i.si(t,h,e,i.name)});t.rect({_:!1,q:"#111",rect:[this.jt,this.Dt,l.Bt,l.Bt]}),1===this.selected.length&&this.It.forEach(({x:i,y:s,width:h,height:e,icon:o,action:r})=>{r.name&&(t.rect({_:!1,ii:r._t()?"#0f0":"rgba(100, 100, 100, 0.7)",rect:[i,s,h,e]}),o(t,i,s),r._t()||t.rect({_:!1,q:"rgba(100, 100, 100, 0.7)",rect:[i,s,h,e]}))}),this.Et&&t.text({text:this.Et,x:this.jt+10,y:this.Dt+210-17,size:3})}}l.hi=(t,i,s)=>{t.ellipse({_:!1,ellipse:[i+30,s+30,20,20,0,0,2*Math.PI],ii:"#0F0",strokeWidth:6}),t.j(()=>{t.rect({_:!1,rect:[i+15,s+15,40,6],q:"#0F0",rotation:Math.PI/4,size:6})})},l.Bt=220,l.zt=10;var a=l,c={ei:{j:function(t){t.rect({q:this.color,rect:[this.x,this.y,5,5]})}},oi:{j:function(t){t.rect({q:this.color,rect:[this.x,this.y-10,10,15]}),[[1,2],[2,3]].forEach(([i,s])=>{t.rect({q:this.color,rect:[this.x+5*(i-2),this.y+5*(s-2),5,5]})}),[[2,0],[1,1],[0,2],[1,3]].forEach(([i,s])=>{t.rect({q:"#FF77A8",rect:[this.x+5*(i-2),this.y+5*(s-2),5,5]})})}},ri:{j:function(t){t.rect({q:this.color,rect:[this.x,this.y,20,20]})}}},u=class{constructor(t,i,s,h,e,o){const r=c[t];this.type=t,this.ni=s,this.x=i,this.y=s,this.dx=h,this.dy=e,this.color=o,this.li=!1,this.ai=!1,this.ci=.6,this.ui=r.j}di({map:t}){const[i,s]=t.ut(this.x,this.y);t.at[s][i]&&(this.ai=!0),this.li=!0}ct({map:t}){this.li||(this.x+=this.dx,this.dy+=this.ci,this.y+=this.dy,this.y-10*Math.random()>this.ni&&this.di({map:t}))}j(t){this.ai||this.ui.call(this,t)}};class d{constructor(t,i,s,h,e,o=null,r){this.Zt=s.Zt,this.Ai=s.Ai,this.fi=s.fi,this.name=s.name,this.pi=s.qt,this.mi=e?0:s.yi,this.cost=s.cost,this.wi=s.wi,this.Jt=s.Jt,this.x=t,this.y=i,this.Mi=0,this.ti=this.Zt,this.selected=!1,this.type="building",this.gi=[],this.color=h,this.bi=r,this.ki=0,this.Ci=e,this.xi=o,this.vi="#666",this.ji=0}Bi(){this.ki=20}zi(t,{Di:i,d:s}){this.Zt-=t;for(let h=0;t>h;h++)i.add(new u("blood",this.x+this.Ai/2,this.y+this.fi/2,8*Math.random()-4+2*s.dx,-16*Math.random()-8+2*s.dy,this.vi));return 0>=this.Zt}Ti({Di:t,kt:i}){i.play("death");for(let i=0;100>i;i++)t.add(new u("blood",this.x+this.Ai/2,this.y+this.fi/2,8*Math.random()-4,-16*Math.random()-8,this.vi));for(let i=0;20>i;i++){const i=Math.floor(34*Math.random()+51);t.add(new u("bit",this.x+this.Ai/2,this.y+this.fi/2,8*Math.random()-4,-16*Math.random()-8,`#${i}${i}${i}`))}}Pi(){return this}ct({bt:t}){this.Mi+=1;const[i]=this.gi;if(i&&(i.time-=1,0>=i.time)){const{complete:i}=this.gi.shift();i({bt:t})}this.ki>0&&(this.ki-=1)}Ii(t,{}){this.gi.push({...t,Fi:t.time})}qt({bt:t}){let i=[,,,,,,,,,].fill({});return this.Ci?this.pi({Ei:this,Si:i,bt:t}):i[8]={name:"cancel",cost:0,_t:()=>!0,Vt:({bt:t})=>{t.Yi(this),t.selected=[]},Jt:a.hi},i}Hi(t,i,s){const{name:h,time:e,Fi:o,Jt:r}=this.gi[0];t.text({text:""+h,x:i+200+60+10,y:s+13,size:5});const n=i+200+60+10,l=s+60-10;t.rect({_:!1,ii:"#0f0",rect:[n,l,200,10]}),t.rect({_:!1,q:"#0f0",rect:[n,l,(o-e)/o*200,10]}),t.rect({_:!1,ii:"#0f0",rect:[i+200,s,60,60]}),r(t,i+200,s)}Qt(t,i,s){this.Jt(t,i-15,s-20),this.gi.length&&(this.Hi(t,i,s),this.gi.slice(1).forEach(({Jt:h},e)=>{t.rect({_:!1,ii:"#0f0",rect:[i+200+70*e,s+60+10,60,60]}),h(t,i+200+70*e,s+10+60)}))}si(t,i,s){d.si(t,i,s)}j(t){const i=this.fi-n.dt,s=s=>{t.ellipse({ellipse:[this.x+this.Ai/2,this.y+i+n.dt,(this.Ai+40)/2,i/3,0,0,2*Math.PI],ii:s,strokeWidth:5})};this.selected&&s("#4AC"),this.ki>0&&s("#A00"),this.wi(t,this.x,this.y,this.Ai,i,this.color,this.Ci?"F":"4"),this.ji||t.Li({x:this.x,y:this.y,color:this.bi,Ai:Math.ceil(this.Ai/20),fi:Math.ceil(this.fi/20)})}}d.si=()=>{};var A=d;const f=function(t,i){return i>t?-1:t>i?1:0},p=function(t,i,s){return null==s&&(s=f),t.push(i),w(t,0,t.length-1,s)},m=function(t,i){var s,h;return null==i&&(i=f),s=t.pop(),t.length?(h=t[0],t[0]=s,M(t,0,i)):h=s,h},y=function(t,i,s){var h;if(null==s&&(s=f),-1!==(h=t.indexOf(i)))return w(t,0,h,s),M(t,h,s)},w=function(t,i,s,h){var e,o,r;for(null==h&&(h=f),e=t[s];s>i&&0>h(e,o=t[r=s-1>>1]);)t[s]=o,s=r;return t[s]=e},M=function(t,i,s){var h,e,o,r,n;for(null==s&&(s=f),e=t.length,n=i,o=t[i],h=2*i+1;e>h;)e>(r=h+1)&&s(t[h],t[r])>=0&&(h=r),t[i]=t[h],h=2*(i=h)+1;return t[i]=o,w(t,n,i,s)},g=function(){function t(t){this.cmp=null!=t?t:f,this.Oi=[]}return t.push=p,t.pop=m,t.Xi=y,t.prototype.push=function(t){return p(this.Oi,t,this.cmp)},t.prototype.pop=function(){return m(this.Oi,this.cmp)},t.prototype.Xi=function(t){return y(this.Oi,t,this.cmp)},t.prototype.empty=function(){return 0===this.Oi.length},t}();function b(t){for(var i=[[t.x,t.y]];t.parent;)i.push([(t=t.parent).x,t.y]);return i.reverse()}function k(t,i,s,h){var e,o,r,n,l,a,c=Math.abs,u=[];for(e=s>t?1:-1,o=h>i?1:-1,l=(r=c(s-t))-(n=c(h-i));u.push([t,i]),t!==s||i!==h;)(a=2*l)>-n&&(l-=n,t+=e),r>a&&(l+=r,i+=o);return u}var C=function(t,i){return t+i};function x(t,i,s){this.x=t,this.y=i,this.$i=void 0===s||s}function v(t,i,s){var h;"object"!=typeof t?h=t:(i=t.length,h=t[0].length,s=t),this.width=h,this.height=i,this.Oi=this.Ni(h,i,s)}function j(){this.Ri=C,this.weight=1,this.Gi=2}v.prototype.Ni=function(t,i,s){var h,e,o=Array(i);for(h=0;i>h;++h)for(o[h]=Array(t),e=0;t>e;++e)o[h][e]=new x(e,h);if(void 0===s)return o;if(s.length!==i||s[0].length!==t)throw Error("Matrix size does not fit");for(h=0;i>h;++h)for(e=0;t>e;++e)s[h][e]&&(o[h][e].$i=!1);return o},v.prototype.Wi=function(t,i){return this.Oi[i][t]},v.prototype.Ui=function(t,i){return this.Ki(t,i)&&this.Oi[i][t].$i},v.prototype.Ki=function(t,i){return t>=0&&this.width>t&&i>=0&&this.height>i},v.prototype._i=function(t){var i=t.x,s=t.y,h=[],e=this.Oi;return this.Ui(i,s-1)&&h.push(e[s-1][i]),this.Ui(i+1,s)&&h.push(e[s][i+1]),this.Ui(i,s+1)&&h.push(e[s+1][i]),this.Ui(i-1,s)&&h.push(e[s][i-1]),h},j.prototype.Vi=function(t,i,s,h,e){var o,r,n,l,a,c,u,d,A=new g((function(t,i){return t.f-i.f})),f=e.Wi(t,i),p=e.Wi(s,h),m=this.Ri,y=this.weight,w=Math.abs;for(f.qi=0,f.f=0,A.push(f),f.Ji=!0;!A.empty();){if((o=A.pop()).closed=!0,o===p)return b(p);for(l=0,a=(r=e._i(o)).length;a>l;++l)(n=r[l]).closed||(u=n.y,d=o.qi+((c=n.x)-o.x==0||u-o.y==0?1:1.4142135623730951),n.Ji&&d>=n.qi||(n.qi=d,n.Qi=n.Qi||y*m(w(c-s),w(u-h)),n.f=n.qi+n.Qi,n.parent=o,n.Ji?A.Xi(n):(A.push(n),n.Ji=!0)))}return[]};var B=j;const z=(t,i,s,h,e={})=>{let o,{Zi:r,ts:n,body:l}=h,a=[];e.blink&&(n="#0000"),o=e.brute?[[r,[0,-1,6,3]],[r,[1,-2,4,5]]]:[[r,[0,0,5,3]]],a=a.concat(o),a=a.concat([[n,[1+(e.brute?1:0),1,1,1]],[n,[4,1,1,1]]]),e.ss||(a=a.concat([[l,[0,4,3,1]],[r,[0,4,1,1]],[r,[3,4,1,1]]])),e.hs&&(a=a.concat([[r,[0,-1,1,1]],[r,[4,-1,1,1]]])),e.es&&(a=a.concat([[r,[1,-1,1,1]],[r,[0,-2,1,1]],[r,[3,-1,1,1]],[r,[4,-2,1,1]],[n,[2,1,1,1]],[n,[3,1,1,1]]]));const c=e.size||8;return a=a.map(([h,e])=>({c:h,r:[1===s?t+e[0]*c:5*c-(e[0]+e[2])*c+t,e[1]*c+i,e[2]*c,e[3]*c]})),a},D=([t,i,s])=>({Zi:t,ts:i,body:s}),T={name:"goblin",Zt:50,os:10,size:40,cost:100,yi:150,vi:"#A00",rs:!0,ns:t=>D(["#50c878",t,t]),speed:5,ss:!1,hs:!0,es:!1,ls:!0,as:"gun",cs:!1,us:!1,xi:!1,range:300,ds:90,As:60};var P={shade:{...T,name:"shade",os:1,rs:!1,ns:t=>D(["#999",t,t]),speed:3,ss:!0,ls:!1,as:"minigun",cs:!0,us:!0,xi:!0,range:50,ds:10,As:10},goblin:{...T},brute:{...T,name:"brute",Zt:100,os:15,size:80,cost:200,hs:!1,brute:!0,yi:300,ns:t=>D(["#c80",t,t]),speed:3,range:100},speeder:{...T,name:"speeder",Zt:150,os:5,cost:200,hs:!1,es:!0,yi:300,ns:t=>D(["#cff",t,t]),speed:8,range:50}};const I=(t,i,s)=>{const{name:h,cost:e,yi:o}=P[t];return{name:"build "+h,cost:e,time:o,_t:function(){return s.Ct>=this.cost},Vt:function({bt:t}){return 5>i.gi.length&&t.Ct>=this.cost&&(t.Ct-=this.cost,i.Ii(this,{bt:t}),!0)},complete:({bt:s})=>{s.fs({type:t,x:i.x+i.Ai+10,y:i.y+i.fi+10})},Jt:(t,i,s)=>{X.si(t,i,s,P[h])}}},F=(t,i,s,h,e,o,r="F",l)=>{if(t.rect({q:"#544"+r,rect:[i,s+n.dt,h,e]}),t.ellipse({ellipse:[i+h/2,s+e+n.dt,h/2,e/4,0,0,2*Math.PI],q:"#544"+r}),t.ellipse({ellipse:[i+h/2,s+n.dt,h/2,e/4,0,0,2*Math.PI],q:"#655"+r}),"flag"===l){const e=10,l=100;t.rect({q:"#666"+r,rect:[i+h/2-e/2,s-l+n.dt,e,l]}),t.rect({q:o+r,rect:[i+h/2+e/2,s-l+n.dt,60,40]})}if("shield"===l){const h=70,e=150;t.ellipse({ellipse:[i+h,s+e,100,100,0,0,Math.PI/3],q:o+r}),t.ellipse({ellipse:[i+h+100,s+e,100,100,0,2*Math.PI/3,3*Math.PI/3],q:o+r}),t.ps({ps:[[i+h,s+e],[i+h+100,s+e],[i+h+50,s+e+100*3**.5/2]],q:o+r})}};var E={base:{name:"base",Zt:50,yi:600,cost:400,Ai:3*n.dt,fi:3*n.dt,qt:({Ei:t,Si:i,bt:s})=>{i[0]=I("shade",t,s)},wi:(...t)=>F(...t,"flag"),Jt:(t,i,s)=>{t.rect({_:!1,rect:[i+14,s+12,7,35],q:"#666"}),t.rect({_:!1,rect:[i+21,s+13,25,18],q:"#0f0"})}},barracks:{name:"barracks",Zt:50,yi:300,cost:150,Ai:3*n.dt,fi:3*n.dt,qt:({Ei:t,Si:i,bt:s})=>{i[0]=I("goblin",t,s),i[1]=I("brute",t,s),i[2]=I("speeder",t,s)},wi:(...t)=>F(...t,"shield"),Jt:(t,i,s)=>{const h=11.5;t.ellipse({_:!1,ellipse:[i+h,s+13,36,36,0,0,Math.PI/3],q:"#0f0"}),t.ellipse({_:!1,ellipse:[i+h+36,s+13,36,36,0,2*Math.PI/3,3*Math.PI/3],q:"#0f0"}),t.ps({_:!1,ps:[[i+h,s+13],[i+h+36,s+13],[i+h+18,s+13+36*3**.5/2]],q:"#0f0"})}}};const S=(t,i)=>i.x+(i.size||i.Ai)>t.x&&t.x+(t.size||t.Ai)>i.x&&i.y+(i.size||i.fi)>t.y&&(t.size||t.fi)+t.y>i.y,Y=(t,i)=>i.x>=t.x&&t.x+(t.size||t.Ai)>i.x&&i.y>=t.y&&t.y+(t.size||t.fi)>i.y,H=(t,i)=>{const s=Math.abs(t.x-i.x),h=Math.abs(t.y-i.y);return Math.sqrt(Math.pow(s,2)+Math.pow(h,2))},L={ms:0,ys:1,ws:2};class O{constructor(t,i,s){Object.entries(s).forEach(([t,i])=>{this[t]=i}),this.x=t,this.y=i,this.Ms=i,this.dx=0,this.dy=0,this.ti=this.Zt,this.Mi=0,this.selected=!1,this.path=[],this.gs=1,this.type="unit",this.bs=0,this.ks=0,this.blink=0,this.target=null,this.ki=0,this.Cs=0,this.state=0,this.xs=0,this.ji=0,this.vs=!1,this.js=null,this.Bs=null,this.zs=null,this.Ds=0,this.Ts=0}Bi(){this.ki=30}Ps(t,i){const[s,h]=t;if(this.us)return this.path=[t],!0;const[e,o]=i.ut(this.x,this.Ms),[r,n]=i.ut(s,h),l=new B,a=new v(i.at),c=l.Vi(e,o,r,n,a);if(0===c.length)return!1;const u=function(t,i){var s,h,e,o,r,n,l,a,c,u,d=i.length,A=i[d-1][0],f=i[d-1][1];for(e=[[s=i[0][0],h=i[0][1]]],o=2;d>o;++o){for(l=k(s,h,(n=i[o])[0],n[1]),c=!1,r=1;l.length>r;++r)if(!t.Ui((a=l[r])[0],a[1])){c=!0;break}c&&(e.push(u=i[o-1]),s=u[0],h=u[1])}return e.push([A,f]),e}(a,c).map(([t,s])=>i.At(t,s)).slice(1,-1).concat([t]);return this.path=u,!0}Is(t,i){this.target=t,this.state=2,this.Cs=15,this.target.Bi();const s=H(this,this.target);this.range>=s||this.Ps([this.target.x,this.target.y],i)}Fs(t){this.path=[],this.js=t,this.state=3}Es({Ei:t}){this.zs=t,this.state=5}Ss(){let[t,i]=this.path[0],s=H({x:this.x,y:this.Ms},{x:t,y:i});s>this.speed?(this.dx=this.speed*((t-this.x)/Math.abs(s)),this.dy=this.speed*((i-this.Ms)/Math.abs(s))):this.path.shift()}zi(t,{Di:i,d:s}){this.Zt-=t;for(let h=0;t>h;h++)i.add(new u("blood",this.x,this.y+this.size/2,6*Math.random()-3+4*s.dx,-10*Math.random()-5+4*s.dy,this.vi));return 0>=this.Zt}Ti({Di:t,kt:i}){i.play("death");for(let i=0;100>i;i++)t.add(new u("blood",this.x,this.y,10*Math.random()-5,-12*Math.random()-6,this.vi));for(let i=0;5>i;i++)t.add(new u("chunk",this.x,this.y,6*Math.random()-3,-6*Math.random()-6,"red"))}Ys(t,i,s=null){this.path=[];let h=s;if(!h){const i=t.Hs.filter(t=>"base"===t.name);i.length&&(i.sort((t,i)=>H(this,t)-H(this,i)),h=i[0])}h&&(this.Bs=h,this.Ps([h.x+h.Ai/2,h.y+h.fi/2],i),this.state=4)}move(){this.path.length?(this.Ss(),this.gs=this.dx>0?1:0):(this.dx=0,this.dy=0,1===this.state&&(this.state=0)),this.x+=this.dx,this.Ms+=this.dy}ct({map:t,Di:i,bt:s,kt:h,Ls:e}){if(this.Mi+=1,.005>Math.random()&&(this.blink=10),this.blink>0&&(this.blink-=1),0===this.state&&.001>Math.random()&&(this.gs=this.gs?0:1),this.ls){const t=12,i=12,s=(1===this.state||2===this.state)&&0===this.ks,h=0===this.state&&.01>Math.random();(s||h)&&(this.ks=i),this.ks>0&&(this.ks-=1,this.bs=-Math.pow(this.ks/(i*(Math.sqrt(t)/(2*t)))-Math.sqrt(t),2)+t)}if(5===this.state&&(0===this.path.length&&this.Ps([this.zs.x+this.zs.Ai/2,this.zs.y+this.zs.fi/2],t),S(this.Pi(),this.zs)&&(this.zs.mi-=1,this.zs.mi>0||(this.zs.Ci=!0,this.state=0,this.xs=0))),3===this.state&&(this.vs||0!==this.path.length?this.vs&&this.Ys(s,t):this.Ps([this.js.x+this.js.size/2,this.js.y+this.js.size/2],t),S(this.Pi(),this.js)&&(this.vs=!0,this.Ys(s,t))),4===this.state&&S(this.Pi(),this.Bs)&&this.vs&&(s.Ct+=10,this.vs=!1,this.Ps([this.js.x+this.js.size/2,this.js.y+this.js.size/2],t),this.state=3),this.rs&&0===this.state){const[i]=e.filter(t=>H(this,t)<=this.range);i&&this.Is(i,t)}if(this.target&&0>=this.target.Zt&&(this.target=null,this.state=0,this.path=[]),this.Ts>0&&(this.Ts-=1),this.Ds>0&&(this.Ds-=1),2===this.state){const s=H(this,this.target),e=this.range>=s;if(this.Cs-=1,0>this.Cs&&!e&&(this.Ps([this.target.x,this.target.y],t),this.Cs=15),e&&0===this.Ds){h.play(this.as),this.Ds=this.ds,this.Ts=this.As,this.path=[];const t=H(this,this.target);this.target.zi(this.os,{Di:i,d:{dx:(this.target.x-this.x)/t,dy:(this.target.y-this.Ms)/t}})}}0===this.Ts&&this.move(),this.y=this.Ms-this.bs,this.ki>0&&(this.ki-=1)}qt({bt:t}){const i=[,,,,,,,,,].fill({}),s={name:"cancel",cost:0,_t:()=>!0,Jt:a.hi,Vt:()=>{this.xs=0,t.Os(),this.zs&&t.Yi(this.zs),this.state=0}},h=i=>({name:"build "+i.name,cost:i.cost,_t:function(){return t.Ct>=this.cost},Jt:(t,s,h)=>{i.Jt(t,s,h)},Vt:()=>{t.Xs({$s:this,Ei:i.name}),this.xs=2}});return this.state===L.Ns?i[5]=s:1===this.xs?(i[0]=h(E.base),i[1]=h(E.barracks),i[5]=s):2===this.xs?i[5]=s:(i[0]={name:"move",cost:0,_t:()=>!0,Jt:(t,i,s)=>{t.ellipse({_:!1,ellipse:[i+30,s+30,23,23,0,0,2*Math.PI],ii:"#0F0",strokeWidth:5}),t.Rs({_:!1,x:i+30,y:s+22,q:"#0F0",rotation:.75*Math.PI,size:15}),t.rect({_:!1,rect:[i+14,s+26,25,7],q:"#0F0"})},Vt:()=>{console.log("move")}},this.xi&&(i[3]={name:"build",cost:0,_t:()=>!0,Jt:(t,i,s)=>{t.Rs({_:!1,x:i+17,y:s+18,q:"#0F0",rotation:.25*Math.PI,size:26}),t.rect({_:!1,rect:[i+18,s+25,24,20],q:"#0F0"}),t.rect({_:!1,rect:[i+26,s+37,7,8],q:"#111"})},Vt:()=>{this.xs=1}})),i}si(t,i,s,h){O.si(t,i,s,{...P[h],ss:this.ss})}Qt(t,i,s,h){z(i,s,1,{Zi:"#0f0",ts:"#666",body:"#666"},{...P[h],size:12}).forEach(({c:i,r:s})=>t.rect({_:!1,q:i,rect:s}))}Pi(){return{x:this.x-this.size/2,y:this.y-this.size/2,size:this.size}}j(t){const i=this.x-this.size/2,s=this.y-this.size/2,h=h=>{t.ellipse({ellipse:[i+this.size/2,s+this.size,(this.size+15)/2,this.size/3,0,0,2*Math.PI],ii:h,strokeWidth:5})};this.selected&&h("#4AC"),this.ki>0&&this.ki%10>5&&h("#A00"),z(i,s,this.gs,this.ns,{ss:this.ss,brute:this.brute,hs:this.hs,es:this.es,blink:this.blink>0,size:this.size/5}).forEach(({c:i,r:s})=>t.rect({q:i,rect:s})),this.vs&&t.j(()=>{t.rect({q:"#39ca",rect:[i+(this.gs?5:-35)+this.size/2,s+10,30,30],rotation:-.05*Math.PI,size:30})}),5>this.As-this.Ts&&([[1===this.gs?8:-1,3,1,1],[1===this.gs?7:0,4,2,3]].forEach(([h,e,o,r])=>t.rect({q:"yellow",rect:[i+6*h,s+6*e,6*o,6*r]})),[[1===this.gs?8:-1,4,2,2],[1===this.gs?10:-3,4,1,1]].forEach(([h,e,o,r])=>t.rect({q:"white",rect:[i+6*h,s+6*e,6*o,6*r]}))),this.ji||t.Li({x:i,y:s,color:this.bi,size:Math.ceil(this.size/20)})}}O.si=(t,i,s,h)=>{z(i+14,s+18,1,{Zi:"#0f0",ts:"#666",body:"#666"},{...h,size:6}).forEach(({c:i,r:s})=>t.rect({_:!1,q:i,rect:s}))};var X=O,$=class{constructor(){this.Ct=500,this.units=[],this.Hs=[]}fs({type:t,x:i,y:s}){const h=P[t],e=h.ns(this.color),o=new X(i,s,{...h,ns:e,bi:this.bi});this.units.push(o)}Gs({type:t,x:i,y:s,Ci:h=!0,$s:e=null}){const o=new A(i,s,E[t],this.color,h,e,this.bi);return this.Hs.push(o),o}Yi(t){t.xi.zs=null,t.xi.state=0,this.Hs=this.Hs.filter(i=>i!==t),this.Ct+=t.cost}Ws({Ei:t,x:i,y:s,$s:h}){const e=this.Gs({type:t,x:i,y:s,Ci:!1,$s:h});this.Ct-=e.cost,h.Es({Ei:e})}entities(){return this.units.concat(this.Hs)}static ct({map:t,Di:i,kt:s,Ls:h}){this.units.forEach(e=>e.ct({Di:i,map:t,bt:this,kt:s,Ls:h})),this.units=this.units.reduce((t,h)=>(h.Zt>0?t.push(h):(h.Ti({Di:i,kt:s}),this.selected&&this.selected.includes(h)&&(this.selected=this.selected.filter(t=>t!==h))),t),[]),this.Hs.forEach(t=>t.ct({bt:this})),this.Hs=this.Hs.reduce((t,h)=>(h.Zt>0?t.push(h):(h.Ti({Di:i,kt:s}),this.selected&&this.selected.includes(h)&&(this.selected=this.selected.filter(t=>t!==h))),t),[])}static j(t){this.Hs.forEach(i=>i.j(t)),this.units.forEach(i=>i.j(t))}};const N=t=>t[Math.floor(Math.random()*t.length)];var R=class extends ${constructor({map:t}){super(),this.color="#00A",this.bi="#F00",t.ht.forEach(([t,i])=>{this.Gs({type:"base",x:80*t,y:80*i})}),t.et.forEach(([t,i])=>{this.fs({type:"shade",x:80*t,y:80*i})}),t.ot.forEach(([t,i])=>{this.fs({type:"goblin",x:80*t,y:80*i})})}Us({map:t,it:i}){if(this.units.filter(t=>"shade"===t.name&&0===t.state).forEach(t=>{i.it.sort((i,s)=>H(t,i)-H(t,s));const[s]=i.it;t.Fs(s)}),0>Math.random()){const i=N(this.units.filter(t=>0===t.state));if(i){const s=[Math.floor(1440+400*Math.random()),Math.floor(80+560*Math.random())],h=i.Ps(s,t);h&&(i.state=1),console.log(`cpu moving ${i.name} to ${s}${h?"":", but failed"}`)}}const[s]=this.Hs.filter(t=>"base"===t.name);if(.001>Math.random()&&this.Ks(s,"build shade"),0===this.Hs.filter(t=>"barracks"===t.name).length&&this.Ct>=250){const i=N(this.units.filter(t=>t.xi));i&&this.Ws({Ei:"barracks",x:s.x-300,y:s.y,map:t,$s:i})}const[h]=this.Hs.filter(t=>"barracks"===t.name);.001>Math.random()&&this.Ks(h,"build goblin")}Ks(t,i){if(!t||!t.Ci)return!1;const[s]=t.qt({bt:this}).filter(({name:t})=>t===i);try{const i=s.Vt({bt:this});console.log(`cpu executing ${s.name} on ${t.name}${i?"":", but failed"}, and has ${this.Ct} left`)}catch(s){console.log("cpu errored on action",t,i)}}ct({map:t,it:i,Di:s,kt:h,Ls:e}){this.Us({map:t,it:i}),$.ct.call(this,{map:t,Di:s,kt:h,Ls:e})}j(t){$.j.call(this,t)}};let G=null;class W{constructor(){let t=document.querySelector("canvas");this.canvas=t,G=this.canvas.getContext("2d"),this.wt=new class{constructor(){this.x=0,this.y=0,this._s=0,this.Vs=0,this.qs=0,this.Js=0}Rt(t){this._s=this.Qs(t)}Gt(t){this.Vs=this.Zs(t)}th(t){return t-this.x}ih(t){return t-this.y}Qs(t){return Math.min(Math.max(0,t),n.size-this.width)}Zs(t){return Math.min(Math.max(0,t),n.size*(n.pt/n.dt)-this.height)}sh(t,i){this.Js>t&&0!==this.qs||(this.qs=i,this.Js=t)}hh(){if(this.qs=Math.max(0,this.qs-1),!this.qs)return;const t=Math.random()*this.Js*2-this.Js,i=Math.random()*this.Js*2-this.Js;this.x+=t,this.y+=i}ct({eh:t,gt:i}){const s=a.zt,[h,e]=i.oh;(t.rh(t.nh)||s>e)&&(this.Vs-=15),(t.rh(t.lh)||e>this.height-s)&&(this.Vs+=15),(t.rh(t.ah)||s>h)&&(this._s-=15),(t.rh(t.uh)||h>this.width-s)&&(this._s+=15),this.Rt(this._s),this.Gt(this.Vs),this.x=this._s,this.y=this.Vs,this.hh()}};let i=document.querySelector("body"),s=()=>{this.wt.height=window.innerHeight,this.wt.width=window.innerWidth,t.height=window.innerHeight,t.width=window.innerWidth,this.height=t.height,this.width=t.width};s(),i.onresize=s,this.dh=[]}j(t){G.save(),t(),G.restore()}Ah(){G.clearRect(0,0,this.canvas.width,this.canvas.height)}$(t,i){this.j(()=>{const s=G.createLinearGradient(0,0,this.height-a.Bt,this.width);s.addColorStop(0,t),s.addColorStop(1,i),G.fillStyle=s,G.fillRect(0,0,this.canvas.width,this.canvas.height)})}rect({rect:t,q:i,ii:s,shadowBlur:h=0,shadowColor:e="none",opacity:o,lineWidth:r=1,_:n=!0,rotation:l,size:a,fh:c=!0}){c&&(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1])),n&&(t[0]=this.wt.th(t[0],this.canvas.width),t[1]=this.wt.ih(t[1],this.canvas.height)),l&&(G.translate(t[0]+a/2,t[1]+a/2),G.rotate(l),G.translate(-1*t[0]-a/2,-1*t[1]-a/2)),G.shadowBlur=h,G.shadowColor=e,o&&(G.globalAlpha=o),i&&(G.fillStyle=i,G.fillRect(t[0],t[1],...t.slice(2))),s&&(G.strokeStyle=s,G.lineWidth=r,G.strokeRect(t[0],t[1],...t.slice(2))),G.shadowBlur=0,G.globalAlpha=1}Rs({x:t,y:i,_:s=!0,q:h,rotation:e,size:o}){this.j(()=>{if(s&&(t=this.wt.th(t,this.canvas.width),i=this.wt.ih(i,this.canvas.height)),e&&(G.translate(t+o/2,i+o/2),G.rotate(e),G.translate(-1*t-o/2,-1*i-o/2)),h){let s=new Path2D;s.moveTo(t,i),s.lineTo(t+o,i),s.lineTo(t,i+o),s.closePath(),G.fillStyle=h,G.fill(s)}})}ellipse({ellipse:t,_:i=!0,q:s,ii:h,strokeWidth:e=1,shadowBlur:o,shadowColor:r}){i&&(t[0]=this.wt.th(t[0],this.canvas.width),t[1]=this.wt.ih(t[1],this.canvas.height)),G.beginPath(),G.ellipse(...t),G.shadowBlur=o,G.shadowColor=r,s&&(G.fillStyle=s,G.fill()),h&&(G.strokeStyle=h,G.lineWidth=e,G.stroke()),G.shadowBlur=0}text({text:t,x:i,y:s,q:h="#fff",size:e=1}){G.fillStyle=h;let o=0;t.toUpperCase().split("").map(t=>(U[t]||console.log(t),U[t])).forEach(t=>{let h=0,r=0;t.forEach(t=>{t.forEach((t,r)=>{t&&G.fillRect(o+r*e+i,h+s,e,e)}),r=Math.max(r,t.length*e),h+=e}),o+=e+r})}ps({ps:t,shadowBlur:i=0,shadowColor:s,q:h,ii:e,_:o=!0}){G.beginPath();let r=t[0][0],n=t[0][1];o&&(r=this.wt.th(r,this.canvas.width),n=this.wt.ih(n,this.canvas.height)),G.moveTo(r,n),t.slice(1).forEach(([t,i])=>{o&&(t=this.wt.th(t,this.canvas.width),i=this.wt.ih(i,this.canvas.height)),G.lineTo(t,i)}),G.closePath(),G.shadowBlur=i,G.shadowColor=s,e&&(G.strokeStyle=e,G.stroke()),h&&(G.fillStyle=h,G.fill())}ph({ph:t,x:i,y:s,_:h=!0}){this.j(()=>{h&&(i=this.wt.th(i,this.canvas.width),s=this.wt.ih(s,this.canvas.height)),G.font="6px serif",G.fillText(t,i,s+2)})}Li({x:t,y:i,size:s,Ai:h,fi:e,color:o}){this.dh.push(()=>this.rect({_:!1,q:o,rect:[t/n.size*250+a.zt,this.canvas.height-250+i/n.size*250-a.zt,h||s,e||s]}))}mh(){this.dh=[]}yh(){this.dh.forEach(t=>{this.j(t)})}Pi({x:t,y:i,size:s}){this.rect({rect:[t-s/2,i-s/2,s,s],color:"#f00"})}}const U={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]]," ":[[,,],[,,],[,,],[,,],[,,]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[1,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[,,1],[,,1]],5:[[1,1,1],[1,,],[1,1,1],[,,1],[1,1,1]],6:[[1,1,1],[1,,],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,,1],[,,1],[,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]],"/":[[,,1],[,,1],[,1],[1,,],[1,,]],"!":[[,1],[,1],[,1],[,,],[,1]]},K={wh:0,ws:1};var _=class extends ${constructor({map:t}){super(),this.selected=[],this.color="#A00",this.bi="#0F0",t.st.forEach(([t,i])=>{this.Gs({type:"base",x:80*t,y:80*i})}),t.rt.forEach(([t,i])=>{this.fs({type:"shade",x:80*t,y:80*i})}),t.nt.forEach(([t,i])=>{this.fs({type:"goblin",x:80*t,y:80*i})}),this.mode=K.wh,this.Mh=null,this.gh=null,this.bh=null,this.kh=[]}Ch(t,i,s){let h=i.filter(i=>{let[s,h,e,o]=t.xh;return S(i.Pi(),{x:s,y:h,Ai:e-s,fi:o-h})});h.map(t=>t.type).includes("unit")&&(h=h.filter(t=>"unit"===t.type)),0!==h.length&&(s.play("click"),i.forEach(t=>t.selected=!1),h.forEach(t=>t.selected=!0),this.selected=h)}vh(t,i,s){let[h,e]=t.St;(h||e)&&i.forEach(t=>{Y(t.Pi(),{x:h,y:e})&&(i.forEach(t=>t.selected=!1),this.selected=[t],t.selected=!0,s.play("click"))})}select(t,i){const s=[this.units,this.Hs].flat();t.xh?this.Ch(t,s,i):this.vh(t,s,i)}jh({Bh:t,target:i}){const{Hs:s,units:h}=t;return h.concat(s).filter(t=>Y(t.Pi(),{x:i[0],y:i[1]}))}zh({Bh:t,map:i,it:s,gt:h,kt:e,$s:o}){const{Wt:r}=h;if(5!==o.state&&(h.Wt[0]||h.Wt[1])){if(o.cs){const[t]=s.it.filter(t=>Y(t,{x:r[0],y:r[1]}));if(t)return o.Fs(t),void e.play("click");if(o.vs){const[t]=this.Hs.filter(t=>"base"===t.name&&Y(t.Pi(),{x:r[0],y:r[1]}));if(t)return o.Ys(this,i,t),void e.play("click")}}const[h]=this.jh({Bh:t,target:r});return!h||(o.Is(h,i),void e.play("click"))}}Xs({$s:t,Ei:i}){this.mode=K.ws,this.Mh=t,this.gh=i}Os(){this.mode=K.ms,this.Mh=null,this.gh=null}Dh(t,i,s){const{St:h,Ht:e}=i;if(this.mode===K.ws){const[i,o]=e,[r,l]=t.ut(i,o),[a,c]=t.At(r,l,!1);e&&(this.bh=t=>{E[this.gh].wi(t,a,c,3*n.dt,2*n.dt,this.color,"4")}),(h[0]||h[1])&&(s.play("click"),this.Ws({Ei:this.gh,x:a,y:c,map:t,$s:this.Mh}),this.Os())}}Kt(t,i,s,h){t.forEach((t,h)=>{const[e,o]=[s[0]+h%8*70,s[1]+70*Math.floor(h/8)];t.Ps([e,o],i),this.kh.push({x:e,y:o,time:20}),t.state=1}),h.play("click")}Nt(t,i,s,h){const e=i&&t[0]-a.zt-h.x,o=i&&t[1]-(s.height-250-a.zt)-h.y;return{$t:null!==e&&null!==o&&e>=0&&250>e&&o>=0&&250>o,x:e,y:o}}Th(t,i,s,h){return i&&t[1]-h.y>=s.height-a.Bt-2*a.zt}Ph({wt:t,Mt:i,Bh:s,map:h,it:e,gt:o,kt:r}){const{$t:n,Ut:l,St:a,Wt:c}=o;if(this.Nt(a,n,i,t).$t)return void console.log("minimap click");if(this.Nt(c,l,i,t).$t)return void console.log("minimap right click");if(this.Th(a,n,i,t))return void console.log("hud click");if(this.Th(c,l,i,t))return void console.log("hud right click");this.select(o,r),this.Dh(h,o,r);const u=[];this.units.forEach(t=>{t.selected&&this.zh({Bh:s,map:h,it:e,gt:o,kt:r,$s:t})&&u.push(t)}),u.length&&this.Kt(u,h,c,r)}ct({wt:t,Bh:i,Mt:s,map:h,it:e,gt:o,Di:r,kt:n,Ls:l}){this.Ph({wt:t,Bh:i,Mt:s,map:h,it:e,gt:o,kt:n}),this.kh=this.kh.map(t=>({...t,time:t.time-1})).filter(t=>t.time>0),$.ct.call(this,{map:h,Di:r,kt:n,Ls:l})}j(t){this.mode===K.ws&&this.bh&&this.bh(t),this.kh.forEach(i=>{5>i.time%10&&t.ellipse({ellipse:[i.x,i.y,23,13,0,0,2*Math.PI],ii:"#4AC",strokeWidth:5})}),$.j.call(this,t)}};const V={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),play:function(...t){return this.Ih(this.Fh(...t))},Ih:function(...t){const i=this.x.createBuffer(t.length,t[0].length,this.sampleRate),s=this.x.createBufferSource();return t.map((t,s)=>i.getChannelData(s).set(t)),s.buffer=i,s.connect(this.x.destination),s.start(),s},Fh:function(t=1,i=.05,s=220,h=0,e=0,o=.1,r=0,n=1,l=0,a=0,c=0,u=0,d=0,A=0,f=0,p=0,m=0,y=1,w=0,M=0){const g=2*Math.PI;let b,k,C=this.sampleRate,x=l*=500*g/C/C,v=s*=(1+2*i*Math.random()-i)*g/C,j=[],B=0,z=0,D=0,T=1,P=0,I=0,F=0;for(a*=500*g/C**3,f*=g/C,c*=g/C,u*=C,d=d*C|0,k=(h=h*C+9)+(w*=C)+(e*=C)+(o*=C)+(m*=C)|0;k>D;j[D++]=F)++I%(100*p|0)||(F=r?r>1?r>2?r>3?Math.sin((B%g)**3):Math.max(Math.min(Math.tan(B),1),-1):1-(2*B/g%2+2)%2:1-4*Math.abs(Math.round(B/g)-B/g):Math.sin(B),F=(d?1-M+M*Math.sin(g*D/d):1)*(F>0?1:-1)*Math.abs(F)**n*t*this.volume*(h>D?D/h:h+w>D?1-(D-h)/w*(1-y):h+w+e>D?y:k-m>D?(k-D-m)/o*y:0),F=m?F/2+(m>D?0:(k-m>D?1:(k-D)/m)*j[D-m|0]/2):F),b=(s+=l+=a)*Math.cos(f*z++),B+=b-b*A*(1-1e9*(Math.sin(D)+1)%2),T&&++T>u&&(s+=c,v+=c,T=0),!d||++P%d||(s=v,l=x,T=T||1);return j},Eh:function(t=0,i=440){return i*2**(t/12)}};let q={death:[2.45,,608,.02,.09,.38,2,1.24,.6,,,,,.3,,.4,.03,.51,.05],gun:[.4,0,0,,,0,4,0,500,,,,,,,.1,,0,.15],jump:[,,131,.02,.02,.08,,1.49,2.3,,,,,,,,,.9,.1],message:[2,0,1740,,.06,.29,,.77,,,,,,,,,,.76,.07,.06],minigun:[.6,0,0,,,0,4,0,1e8,,,,,,,.04,,0,.08],pickup:[,,548,.08,.36,.47,1,1.79,,,236,.03,.08,,,,,.83],shotgun:[.8,,300,,,.9,4,.5,,,,,,10,74,.2,,2],sniper:[.8,,300,,,1.2,4,.5,,,,,,10,74,.1,,2],thrown:[1,0,0,,,0,4,0,1e8,,,,,,,.055,,0,.3],click:[.5,,555,.01,.02,.01,3,.11,,98,-816,.01,.02,,,,,.43,,.02]};class J{constructor(){this.volume=1}play(t,i){const s=[...q[t]];i&&(s[0]*=i*this.volume),function(...t){V.play(...t)}(...s)}Sh(t){this.volume=t}}let Q=0;window.onload=()=>{let t=new W,i=new h({k:t.canvas.width,ch:t.canvas.height}),s=new class{constructor(){document.addEventListener("keyup",t=>this.Yh(t)),document.addEventListener("keydown",t=>this.Hh(t)),this.Lh={},this.Oh={eh:[32],controller:[0,1,5,7]},this.ah={eh:[37],controller:[14],dir:"l"},this.nh={eh:[38],controller:[12,2,3]},this.uh={eh:[39],controller:[15],dir:"r"},this.lh={eh:[40],controller:[13]}}Xh(t){if(!navigator.getGamepads()[0])return!1;const i=navigator.getGamepads()[0].axes;return{s:0>i[0],r:i[0]>0}[t]}$h(t){return!!navigator.getGamepads()[0]&&navigator.getGamepads()[0].buttons.reduce((t,i,s)=>i.pressed?t.concat([s]):t,[]).some(i=>t.includes(i))}Nh(t){return t.some(t=>this.Lh[t])}rh(t){return this.Xh(t.dir)||this.Nh(t.eh)||this.$h(t.controller)||!1}Hh(t){this.Lh[t.keyCode]=!0}Yh(t){delete this.Lh[t.keyCode]}},e=new class{constructor(){let t=document.querySelector("canvas");this.canvas=t,this.canvas.addEventListener("click",t=>this.click(t)),this.canvas.addEventListener("mousedown",t=>this.Rh(t)),this.canvas.addEventListener("mouseup",t=>this.Gh(t)),this.canvas.addEventListener("mousemove",t=>this.Wh(t)),this.canvas.addEventListener("contextmenu",t=>{t.preventDefault(),this.Uh(t)}),this.Kh=[null,null],this._h=[null,null],this.Ht=[null,null],this.oh=[500,500],this.Vh=!1,this.qh=!1,this.xh=null,this.Jh=[null,null]}ct({wt:t}){this.wt=t,this.xh=null,this.qh&&!this.Vh&&(Math.abs(this.Jh[0]-this.Ht[0])>2||Math.abs(this.Jh[1]-this.Ht[1])>2)&&(this.xh=this.Jh.concat(this.Ht),this.Jh=[null,null]),this.qh=this.Vh,this.St=this.Kh,this.$t=this.St[0]||this.St[1],this.Wt=this._h,this.Ut=this.Wt[0]||this.Wt[1],this.Kh=this._h=[null,null]}click({clientX:t,clientY:i}){this.Kh=[t+this.wt.x,i+this.wt.y]}Rh({clientX:t,clientY:i,which:s}){1===s&&(this.Jh=[t+this.wt.x,i+this.wt.y],this.Vh=!0)}Gh(){this.Vh=!1}Wh({clientX:t,clientY:i}){this.wt&&(this.Ht=[t+this.wt.x,i+this.wt.y],this.oh=[t,i])}Uh({clientX:t,clientY:i}){this._h=[t+this.wt.x,i+this.wt.y]}j(t){this.Vh&&t.rect({rect:[this.Jh[0],this.Jh[1],this.Ht[0]-this.Jh[0],this.Ht[1]-this.Jh[1]],ii:"#369"})}},o=new J,r=new class{constructor(){this.Qh=[]}ct({Zh:t,Bh:i,it:s,map:h}){const e=[];for(let t=0;h.height>t;t++){const t=[];for(let i=0;h.width>i;i++)t.push(1);e.push(t)}const o=t=>Math.min(Math.max(0,t),h.width-1),r=t=>Math.min(Math.max(0,t),h.height-1);t.entities().forEach(t=>{const[i,s]=h.ut(t.x,t.y);for(let t=r(s-10);t<=r(s+10);t++){const h=Math.floor(Math.sqrt(Math.abs(100-Math.abs(t-s)**2)));for(let s=o(i-h);s<=o(i+h);s++)e[t][s]=0}}),i.entities().concat(s.it).forEach(t=>{const{x:i,y:s}=t;t.ji=e[Math.floor(s/n.dt)][Math.floor(i/n.dt)]}),this.Qh=e}j(t){this.Qh.forEach((i,s)=>{i.forEach((i,h)=>{i&&t.rect({q:"#222",rect:[h*n.ft,s*n.pt,n.ft,n.pt]})})})}},l=new a,c=new class{constructor(){this.te=!1,this.ie=!1}ct({Zh:t,Bh:i}){0===i.entities().length&&(this.ie=!0),0===t.entities().length&&(this.te=!0)}j(t){this.ie&&(t.rect({_:!1,rect:[(t.width-1e3)/2,(t.height-200)/2-100,1e3,200],q:"#111"}),t.text({q:"#EEE",text:"VICTORY!",x:(t.width-1e3)/2+140,y:(t.height-200)/2+48-100,size:20})),this.te&&(t.rect({_:!1,rect:[(t.width-1e3)/2,(t.height-200)/2-100,1e3,200],q:"#111"}),t.text({q:"#EEE",text:"DEFEAT!",x:(t.width-1e3)/2+235,y:(t.height-200)/2+48-100,size:20}))}},u=new n,d=new class{constructor({map:t}){this.it=[],t.it.forEach(([t,i])=>{this.it.push(new class{constructor(t,i){this.Ct=1e4,this.x=t,this.y=i,this.size=160,this.ji=0}ct(){}j(t){t.rect({q:"#338",rect:[this.x,this.y+this.size/2,this.size,this.size/2]}),t.ellipse({q:"#338",ellipse:[this.x+this.size/2,this.y+this.size/2,this.size/2,this.size/2,0,0,2*Math.PI]}),t.rect({q:"#111",rect:[this.x+this.size/2-25,this.y+this.size-25,50,25]}),t.ellipse({q:"#111",ellipse:[this.x+this.size/2,this.y+this.size-25,25,25,0,0,2*Math.PI]}),this.ji||t.Li({x:this.x,y:this.y,color:"#69c",size:Math.ceil(this.size/20)})}}(t*n.dt,i*n.dt))})}ct(){this.it.forEach(t=>{t.ct()})}j(t){this.it.forEach(i=>{i.j(t)})}}({map:u}),A=new class{constructor(){}j(t){t.rect({_:!1,q:"#666",rect:[0,t.height-250-2*a.zt,250+2*a.zt,250+2*a.zt]}),t.rect({_:!1,q:"#111",rect:[a.zt,t.height-250-a.zt,250,250]}),t.rect({_:!1,ii:"#fff",rect:[t.wt._s/n.size*250+a.zt,t.height-250+t.wt.Vs/(n.pt/n.dt*n.size)*250-a.zt,t.width/n.size*250,t.height/(n.pt/n.dt*n.size)*250]}),t.yh()}},f=new _({map:u}),p=new R({map:u}),m=new class{constructor(){this.Di=[]}add(t){this.Di.push(t)}ct({map:t}){this.Di.length>5e3&&(this.Di=this.Di.slice(this.Di.length-5e3)),this.Di.forEach(i=>i.ct({map:t}))}j(t){this.Di.forEach(i=>i.j(t))}},y=new class{constructor(){this.time=300}ct(){this.time>0&&(this.time-=1)}j(t){const i=(19>this.time?"0":"")+Math.floor(this.time/300*256).toString(16),s="#FFFFFF"+i;t.rect({_:!1,rect:[0,0,t.width,t.height],q:"#111111"+i});const h=t.width/2-380,e=t.height/2-300;t.text({text:"THERE CAN",x:30+h,y:0+e,size:20,q:s}),t.text({text:"BE ONLY",x:110+h,y:150+e,size:20,q:s}),t.text({text:"DEATH",x:0+h,y:300+e,size:40,q:s})}},w=i=>{window.requestAnimationFrame(w),i-Q&&(M(),t.Ah(),t.mh(),g().map(i=>i.j(t)),Q=i-0)},M=()=>{const{wt:i}=t;c.ct({Bh:p,Zh:f}),i.ct({eh:s,gt:e}),e.ct({wt:i}),p.ct({map:u,it:d,Di:m,kt:o,Ls:f.entities()}),f.ct({wt:i,Bh:p,Mt:t,map:u,it:d,gt:e,Di:m,kt:o,Ls:p.entities()}),d.ct(),l.ct({wt:i,Mt:t,map:u,gt:e,bt:f,kt:o}),m.ct({map:u}),r.ct({Zh:f,Bh:p,it:d,map:u}),y.ct()},g=()=>[i,u,m,d,p,f,e,r,l,A,c,y];w()}}]);